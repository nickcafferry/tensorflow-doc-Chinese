

<!DOCTYPE html>
<html class="writer-html5" lang="Chinese" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tensorflow.python.ops.gen_data_flow_ops &mdash; tensorflow 0.1.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/GCC.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> tensorflow
          

          
            
            <img src="../../../../_static/GCC.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">从TensorFlow开始 (Getting Started)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html">TensorFlow如何工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id1">变量和张量的声明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id2">使用占位符和变量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id3">矩阵</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id4">操作符的声明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id5">载入激活函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id6">数据资源</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id7">资源库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../01_Introduction/index.html#id8">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">TensorFlow方式 (TensorFlow Way)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html">计算图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id2">分层嵌套操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id3">多层操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id4">载入损失函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id5">载入反向传播</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id6">随机和批量训练</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id7">结合训练</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id8">模型评估</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../02_TensorFlow_Way/index.html#id9">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">线性回归 (Linear Regression)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html">矩阵转置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#id2">矩阵分解法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#tensorflow">TensorFLow的线性回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#id3">线性回归的损失函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#deming">Deming回归(全回归)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#lasso-ridge">套索(Lasso)回归和岭(Ridge)回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#elastic-net">弹性网(Elastic Net)回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#logistic">逻辑(Logistic)回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../03_Linear_Regression/index.html#id4">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">支持向量机(Support Vector Machines)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#id2">线性支持向量机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#id3">回归线性回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#tensorflow">TensorFlow中的核</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#id4">非线性支持向量机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#id5">多类支持向量机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../04_Support_Vector_Machines/index.html#id6">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">最近邻法 (Nearest Neighbor Methods)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id2">最近邻法的使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id3">文本距离函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id4">计算混合距离函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id5">地址匹配</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id6">图像处理的近邻法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../05_Nearest_Neighbor_Methods/index.html#id7">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">神经元网络 (Neural Networks)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id2">载入操作门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id3">门运算和激活函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id4">载入一层神经网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id5">载入多层神经网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id6">使用多层神经网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id7">线性模型预测改善</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id8">神经网络学习井字棋</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../06_Neural_Networks/index.html#id9">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">自然语言处理(NLP)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#bag-of-words">词袋 (Bag of Words)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#tf-idf">词频-逆文本频率 (TF-IDF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#skip-gram">运用Skip-Gram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#cbow-continuous-bag-fo-words">CBOW (Continuous Bag fo Words)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#word2vec">Word2Vec应用实例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#doc2vec-sentiment-analysis">Doc2Vec情感分析 (Sentiment Analysis)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#id2">神经网络学习井字棋</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../07_Natural_Language_Processing/index.html#id3">本章学习模块</a></li>
</ul>
<p class="caption"><span class="caption-text">卷积神经网络(CNN)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html#simple-cnns">简单卷积神经网络 (Simple CNNs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html#advanced-cnns">高级卷积神经网络 (Advanced CNNs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html#id2">重新训练一个存在架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html#stylenet-neural-style">使用Stylenet/Neural-Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../08_Convolutional_Neural_Networks/index.html#deep-dream">运用Deep Dream</a></li>
</ul>
<p class="caption"><span class="caption-text">递归神经网络(RNN)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html">引言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html#id2">卷积神经网络模型用于垃圾信息检测</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html#lstm">LSTM模型用于文本生成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html#id3">堆叠多层LSTM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html#seq2seq">创建段对段模型翻译 (Seq2Seq)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../09_Recurrent_Neural_Networks/index.html#siamese">训练Siamese相似度测量</a></li>
</ul>
<p class="caption"><span class="caption-text">TensorFlow的应用技巧</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_Taking_TensorFlow_to_Production/index.html">单元测试</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_Taking_TensorFlow_to_Production/index.html#id2">使用多个执行器 (设备)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_Taking_TensorFlow_to_Production/index.html#tensorflow">TensorFlow平行化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_Taking_TensorFlow_to_Production/index.html#id3">TensorFlow开发贴士</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_Taking_TensorFlow_to_Production/index.html#id4">TensorFlow开发实例</a></li>
</ul>
<p class="caption"><span class="caption-text">TensorFlow的更多功能</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html">计算图可视化(用Tensorboard)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html#id1">遗传算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html#k-means">K-means聚类分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html#id2">解决体系常微分方程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html#id3">随机森林</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../11_More_with_TensorFlow/index.html#tensorflowkeras">TensorFlow中的Keras</a></li>
</ul>
<p class="caption"><span class="caption-text">TF Cookbook</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html">书籍介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id2">第一章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id3">第二章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id4">第三章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id5">第四章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id6">第五章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id7">第六章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id8">第七章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id9">第八章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id10">第九章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id11">第十章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id12">第十一章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bookindex.html#id13">索引</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">tensorflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>tensorflow.python.ops.gen_data_flow_ops</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tensorflow.python.ops.gen_data_flow_ops</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Python wrappers around TensorFlow ops.</span>

<span class="sd">This file is MACHINE GENERATED! Do not edit.</span>
<span class="sd">Original C++ source file: data_flow_ops.cc</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">tensorflow.python</span> <span class="k">import</span> <span class="n">pywrap_tfe</span> <span class="k">as</span> <span class="n">pywrap_tfe</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.eager</span> <span class="k">import</span> <span class="n">context</span> <span class="k">as</span> <span class="n">_context</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.eager</span> <span class="k">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">_core</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.eager</span> <span class="k">import</span> <span class="n">execute</span> <span class="k">as</span> <span class="n">_execute</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="k">import</span> <span class="n">dtypes</span> <span class="k">as</span> <span class="n">_dtypes</span>

<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="k">import</span> <span class="n">op_def_registry</span> <span class="k">as</span> <span class="n">_op_def_registry</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="k">import</span> <span class="n">ops</span> <span class="k">as</span> <span class="n">_ops</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.framework</span> <span class="k">import</span> <span class="n">op_def_library</span> <span class="k">as</span> <span class="n">_op_def_library</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.util.deprecation</span> <span class="k">import</span> <span class="n">deprecated_endpoints</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.util</span> <span class="k">import</span> <span class="n">dispatch</span> <span class="k">as</span> <span class="n">_dispatch</span>
<span class="kn">from</span> <span class="nn">tensorflow.python.util.tf_export</span> <span class="k">import</span> <span class="n">tf_export</span>


<span class="k">def</span> <span class="nf">accumulator_apply_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Applies a gradient to a given accumulator.</span>

<span class="sd">  Does not add if local_step is lesser than the accumulator&#39;s global_step.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a accumulator.</span>
<span class="sd">    local_step: A `Tensor` of type `int64`.</span>
<span class="sd">      The local_step value at which the gradient was computed.</span>
<span class="sd">    gradient: A `Tensor`. Must be one of the following types: `float32`, `float64`, `int32`, `uint8`, `int16`, `int8`, `complex64`, `int64`, `qint8`, `quint8`, `qint32`, `bfloat16`, `uint16`, `complex128`, `half`, `uint32`, `uint64`.</span>
<span class="sd">      A tensor of the gradient to be accumulated.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_apply_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorApplyGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="o">=</span><span class="n">local_step</span><span class="p">,</span>
                                    <span class="n">gradient</span><span class="o">=</span><span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">AccumulatorApplyGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.AccumulatorApplyGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">accumulator_apply_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">accumulator_apply_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_apply_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">accumulator_num_accumulated</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the number of gradients aggregated in the given accumulators.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to an accumulator.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_num_accumulated op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">AccumulatorNumAccumulated</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.AccumulatorNumAccumulated&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">accumulator_num_accumulated</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">accumulator_num_accumulated_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_num_accumulated op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">accumulator_set_global_step</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Updates the accumulator with a new value for global_step.</span>

<span class="sd">  Logs warning if the accumulator&#39;s value is already higher than</span>
<span class="sd">  new_global_step.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to an accumulator.</span>
<span class="sd">    new_global_step: A `Tensor` of type `int64`.</span>
<span class="sd">      The new global_step value to set.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_set_global_step op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorSetGlobalStep&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                    <span class="n">new_global_step</span><span class="o">=</span><span class="n">new_global_step</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">AccumulatorSetGlobalStep</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.AccumulatorSetGlobalStep&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">accumulator_set_global_step</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">accumulator_set_global_step_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_set_global_step op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">accumulator_take_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extracts the average gradient in the given ConditionalAccumulator.</span>

<span class="sd">  The op blocks until sufficient (i.e., more than num_required)</span>
<span class="sd">  gradients have been accumulated.  If the accumulator has already</span>
<span class="sd">  aggregated more than num_required gradients, it returns the average of</span>
<span class="sd">  the accumulated gradients.  Also automatically increments the recorded</span>
<span class="sd">  global_step in the accumulator by 1, and resets the aggregate to 0.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to an accumulator.</span>
<span class="sd">    num_required: A `Tensor` of type `int32`.</span>
<span class="sd">      Number of gradients required before we return an aggregate.</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The data type of accumulated gradients. Needs to correspond to the type</span>
<span class="sd">      of the accumulator.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_take_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="o">=</span><span class="n">num_required</span><span class="p">,</span>
                                   <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;AccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">AccumulatorTakeGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.AccumulatorTakeGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">accumulator_take_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">accumulator_take_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;accumulator_take_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">barrier</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Defines a barrier that persists across different graph executions.</span>

<span class="sd">  A barrier represents a key-value map, where each key is a string, and</span>
<span class="sd">  each value is a tuple of tensors.</span>

<span class="sd">  At runtime, the barrier contains &#39;complete&#39; and &#39;incomplete&#39;</span>
<span class="sd">  elements. A complete element has defined tensors for all components of</span>
<span class="sd">  its value tuple, and may be accessed using BarrierTakeMany. An</span>
<span class="sd">  incomplete element has some undefined components in its value tuple,</span>
<span class="sd">  and may be updated using BarrierInsertMany.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. Each shape must be 1 in the</span>
<span class="sd">      first dimension. The length of this attr must be the same as the length of</span>
<span class="sd">      component_types.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The capacity of the barrier.  The default capacity is MAX_INT32,</span>
<span class="sd">      which is the largest capacity of the underlying queue.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this barrier is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this barrier will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;barrier&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;barrier&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;Barrier&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                   <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                   <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;Barrier&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">Barrier</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.Barrier&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">barrier_close</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Closes the given barrier.</span>

<span class="sd">  This operation signals that no more new elements will be inserted in the</span>
<span class="sd">  given barrier. Subsequent InsertMany that try to introduce a new key will fail.</span>
<span class="sd">  Subsequent InsertMany operations that just add missing components to already</span>
<span class="sd">  existing elements will continue to succeed. Subsequent TakeMany operations will</span>
<span class="sd">  continue to succeed if sufficient completed elements remain in the barrier.</span>
<span class="sd">  Subsequent TakeMany operations that would block will fail immediately.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a barrier.</span>
<span class="sd">    cancel_pending_enqueues: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      If true, all pending enqueue requests that are</span>
<span class="sd">      blocked on the barrier&#39;s queue will be canceled. InsertMany will fail, even</span>
<span class="sd">      if no new key is introduced.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">cancel_pending_enqueues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;BarrierClose&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                        <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">BarrierClose</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.BarrierClose&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier_close</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_close_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">barrier_incomplete_size</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Computes the number of incomplete elements in the given barrier.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a barrier.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_incomplete_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;BarrierIncompleteSize&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;BarrierIncompleteSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">BarrierIncompleteSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.BarrierIncompleteSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier_incomplete_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_incomplete_size_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_incomplete_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">barrier_insert_many</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">component_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;For each key, assigns the respective value to the specified component.</span>

<span class="sd">  If a key is not found in the barrier, this operation will create a new</span>
<span class="sd">  incomplete element. If a key is found in the barrier, and the element</span>
<span class="sd">  already has a value at component_index, this operation will fail with</span>
<span class="sd">  INVALID_ARGUMENT, and leave the barrier in an undefined state.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a barrier.</span>
<span class="sd">    keys: A `Tensor` of type `string`.</span>
<span class="sd">      A one-dimensional tensor of keys, with length n.</span>
<span class="sd">    values: A `Tensor`.</span>
<span class="sd">      An any-dimensional tensor of values, which are associated with the</span>
<span class="sd">      respective keys. The 0th dimension must have length n.</span>
<span class="sd">    component_index: An `int`.</span>
<span class="sd">      The component of the barrier elements that is being assigned.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_insert_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">component_index</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">component_index</span><span class="p">,</span> <span class="s2">&quot;component_index&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;BarrierInsertMany&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">component_index</span><span class="o">=</span><span class="n">component_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">BarrierInsertMany</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.BarrierInsertMany&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier_insert_many</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_insert_many_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">component_index</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_insert_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">barrier_ready_size</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Computes the number of complete elements in the given barrier.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a barrier.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_ready_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;BarrierReadySize&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;BarrierReadySize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">BarrierReadySize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.BarrierReadySize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier_ready_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_ready_size_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_ready_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
<span class="n">_BarrierTakeManyOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;BarrierTakeMany&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">barrier_take_many</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">allow_small_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_for_incomplete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Takes the given number of completed elements from a barrier.</span>

<span class="sd">  This operation concatenates completed-element component tensors along</span>
<span class="sd">  the 0th dimension to make a single component tensor.</span>

<span class="sd">  Elements come out of the barrier when they are complete, and in the order</span>
<span class="sd">  in which they were placed into the barrier.  The indices output provides</span>
<span class="sd">  information about the batch in which each element was originally inserted</span>
<span class="sd">  into the barrier.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a barrier.</span>
<span class="sd">    num_elements: A `Tensor` of type `int32`.</span>
<span class="sd">      A single-element tensor containing the number of elements to</span>
<span class="sd">      take.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    allow_small_batch: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      Allow to return less than num_elements items if barrier is</span>
<span class="sd">      already closed.</span>
<span class="sd">    wait_for_incomplete: An optional `bool`. Defaults to `False`.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is empty, this operation will block for up to</span>
<span class="sd">      timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (indices, keys, values).</span>

<span class="sd">    indices: A `Tensor` of type `int64`.</span>
<span class="sd">    keys: A `Tensor` of type `string`.</span>
<span class="sd">    values: A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_take_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;barrier_take_many&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">allow_small_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">allow_small_batch</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">allow_small_batch</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">allow_small_batch</span><span class="p">,</span> <span class="s2">&quot;allow_small_batch&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">wait_for_incomplete</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">wait_for_incomplete</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">wait_for_incomplete</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">wait_for_incomplete</span><span class="p">,</span> <span class="s2">&quot;wait_for_incomplete&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;BarrierTakeMany&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_elements</span><span class="o">=</span><span class="n">num_elements</span><span class="p">,</span>
                           <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                           <span class="n">allow_small_batch</span><span class="o">=</span><span class="n">allow_small_batch</span><span class="p">,</span>
                           <span class="n">wait_for_incomplete</span><span class="o">=</span><span class="n">wait_for_incomplete</span><span class="p">,</span>
                           <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;allow_small_batch&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;allow_small_batch&quot;</span><span class="p">),</span>
              <span class="s2">&quot;wait_for_incomplete&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;wait_for_incomplete&quot;</span><span class="p">),</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;BarrierTakeMany&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_result</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_BarrierTakeManyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">BarrierTakeMany</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.BarrierTakeMany&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">barrier_take_many</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">barrier_take_many_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">allow_small_batch</span><span class="p">,</span> <span class="n">wait_for_incomplete</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;barrier_take_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">conditional_accumulator</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">reduction_type</span><span class="o">=</span><span class="s2">&quot;MEAN&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A conditional accumulator for aggregating gradients.</span>

<span class="sd">  The accumulator accepts gradients marked with local_step greater or</span>
<span class="sd">  equal to the most recent global_step known to the accumulator. The</span>
<span class="sd">  average can be extracted from the accumulator, provided sufficient</span>
<span class="sd">  gradients have been accumulated. Extracting the average automatically</span>
<span class="sd">  resets the aggregate to 0, and increments the global_step recorded by</span>
<span class="sd">  the accumulator.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The type of the value being accumulated.</span>
<span class="sd">    shape: A `tf.TensorShape` or list of `ints`.</span>
<span class="sd">      The shape of the values, can be [], in which case shape is unknown.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator will be shared under the</span>
<span class="sd">      given name across multiple sessions.</span>
<span class="sd">    reduction_type: An optional `string` from: `&quot;MEAN&quot;, &quot;SUM&quot;`. Defaults to `&quot;MEAN&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;conditional_accumulator op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">reduction_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reduction_type</span> <span class="o">=</span> <span class="s2">&quot;MEAN&quot;</span>
  <span class="n">reduction_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">reduction_type</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                  <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                  <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
                                  <span class="n">reduction_type</span><span class="o">=</span><span class="n">reduction_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">),</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;reduction_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">ConditionalAccumulator</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ConditionalAccumulator&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">conditional_accumulator</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">conditional_accumulator_eager_fallback</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">reduction_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;conditional_accumulator op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete_session_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Delete the tensor specified by its handle in the session.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">      The handle for a tensor stored in the session state.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;DeleteSessionTensor&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">delete_session_tensor_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;DeleteSessionTensor&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">DeleteSessionTensor</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.DeleteSessionTensor&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">delete_session_tensor</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">delete_session_tensor_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;DeleteSessionTensor&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<div class="viewcode-block" id="dynamic_partition"><a class="viewcode-back" href="../../../../index.html#tensorflow.dynamic_partition">[docs]</a><span class="nd">@_dispatch</span><span class="o">.</span><span class="n">add_dispatch_list</span>
<span class="nd">@tf_export</span><span class="p">(</span><span class="s1">&#39;dynamic_partition&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dynamic_partition</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Partitions `data` into `num_partitions` tensors using indices from `partitions`.</span>

<span class="sd">  For each index tuple `js` of size `partitions.ndim`, the slice `data[js, ...]`</span>
<span class="sd">  becomes part of `outputs[partitions[js]]`.  The slices with `partitions[js] = i`</span>
<span class="sd">  are placed in `outputs[i]` in lexicographic order of `js`, and the first</span>
<span class="sd">  dimension of `outputs[i]` is the number of entries in `partitions` equal to `i`.</span>
<span class="sd">  In detail,</span>

<span class="sd">  ```python</span>
<span class="sd">      outputs[i].shape = [sum(partitions == i)] + data.shape[partitions.ndim:]</span>

<span class="sd">      outputs[i] = pack([data[js, ...] for js if partitions[js] == i])</span>
<span class="sd">  ```</span>

<span class="sd">  `data.shape` must start with `partitions.shape`.</span>

<span class="sd">  For example:</span>

<span class="sd">  ```python</span>
<span class="sd">      # Scalar partitions.</span>
<span class="sd">      partitions = 1</span>
<span class="sd">      num_partitions = 2</span>
<span class="sd">      data = [10, 20]</span>
<span class="sd">      outputs[0] = []  # Empty with shape [0, 2]</span>
<span class="sd">      outputs[1] = [[10, 20]]</span>

<span class="sd">      # Vector partitions.</span>
<span class="sd">      partitions = [0, 0, 1, 1, 0]</span>
<span class="sd">      num_partitions = 2</span>
<span class="sd">      data = [10, 20, 30, 40, 50]</span>
<span class="sd">      outputs[0] = [10, 20, 50]</span>
<span class="sd">      outputs[1] = [30, 40]</span>
<span class="sd">  ```</span>

<span class="sd">  See `dynamic_stitch` for an example on how to merge partitions back.</span>

<span class="sd">  &lt;div style=&quot;width:70%; margin:auto; margin-bottom:10px; margin-top:20px;&quot;&gt;</span>
<span class="sd">  &lt;img style=&quot;width:100%&quot; src=&quot;https://www.tensorflow.org/images/DynamicPartition.png&quot; alt&gt;</span>
<span class="sd">  &lt;/div&gt;</span>

<span class="sd">  Args:</span>
<span class="sd">    data: A `Tensor`.</span>
<span class="sd">    partitions: A `Tensor` of type `int32`.</span>
<span class="sd">      Any shape.  Indices in the range `[0, num_partitions)`.</span>
<span class="sd">    num_partitions: An `int` that is `&gt;= 1`.</span>
<span class="sd">      The number of partitions to output.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `num_partitions` `Tensor` objects with the same type as `data`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;DynamicPartition&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="s2">&quot;num_partitions&quot;</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dynamic_partition_eager_fallback</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
      <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span>
              <span class="n">dynamic_partition</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="n">partitions</span><span class="p">,</span>
                                 <span class="n">num_partitions</span><span class="o">=</span><span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">OpDispatcher</span><span class="o">.</span><span class="n">NOT_SUPPORTED</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">result</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">,</span> <span class="s2">&quot;num_partitions&quot;</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;DynamicPartition&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="n">partitions</span><span class="p">,</span>
                            <span class="n">num_partitions</span><span class="o">=</span><span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span>
          <span class="n">dynamic_partition</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="o">=</span><span class="n">partitions</span><span class="p">,</span>
                             <span class="n">num_partitions</span><span class="o">=</span><span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">OpDispatcher</span><span class="o">.</span><span class="n">NOT_SUPPORTED</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">raise</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;num_partitions&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;num_partitions&quot;</span><span class="p">),</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;DynamicPartition&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span></div>

<span class="n">DynamicPartition</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.DynamicPartition&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">dynamic_partition</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">dynamic_partition_eager_fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">,</span> <span class="s2">&quot;num_partitions&quot;</span><span class="p">)</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">partitions</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="n">partitions</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;num_partitions&quot;</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;DynamicPartition&quot;</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;DynamicPartition&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<div class="viewcode-block" id="dynamic_stitch"><a class="viewcode-back" href="../../../../index.html#tensorflow.dynamic_stitch">[docs]</a><span class="nd">@_dispatch</span><span class="o">.</span><span class="n">add_dispatch_list</span>
<span class="nd">@tf_export</span><span class="p">(</span><span class="s1">&#39;dynamic_stitch&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dynamic_stitch</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Interleave the values from the `data` tensors into a single tensor.</span>

<span class="sd">  Builds a merged tensor such that</span>

<span class="sd">  ```python</span>
<span class="sd">      merged[indices[m][i, ..., j], ...] = data[m][i, ..., j, ...]</span>
<span class="sd">  ```</span>

<span class="sd">  For example, if each `indices[m]` is scalar or vector, we have</span>

<span class="sd">  ```python</span>
<span class="sd">      # Scalar indices:</span>
<span class="sd">      merged[indices[m], ...] = data[m][...]</span>

<span class="sd">      # Vector indices:</span>
<span class="sd">      merged[indices[m][i], ...] = data[m][i, ...]</span>
<span class="sd">  ```</span>

<span class="sd">  Each `data[i].shape` must start with the corresponding `indices[i].shape`,</span>
<span class="sd">  and the rest of `data[i].shape` must be constant w.r.t. `i`.  That is, we</span>
<span class="sd">  must have `data[i].shape = indices[i].shape + constant`.  In terms of this</span>
<span class="sd">  `constant`, the output shape is</span>

<span class="sd">      merged.shape = [max(indices)] + constant</span>

<span class="sd">  Values are merged in order, so if an index appears in both `indices[m][i]` and</span>
<span class="sd">  `indices[n][j]` for `(m,i) &lt; (n,j)` the slice `data[n][j]` will appear in the</span>
<span class="sd">  merged result. If you do not need this guarantee, ParallelDynamicStitch might</span>
<span class="sd">  perform better on some devices.</span>

<span class="sd">  For example:</span>

<span class="sd">  ```python</span>
<span class="sd">      indices[0] = 6</span>
<span class="sd">      indices[1] = [4, 1]</span>
<span class="sd">      indices[2] = [[5, 2], [0, 3]]</span>
<span class="sd">      data[0] = [61, 62]</span>
<span class="sd">      data[1] = [[41, 42], [11, 12]]</span>
<span class="sd">      data[2] = [[[51, 52], [21, 22]], [[1, 2], [31, 32]]]</span>
<span class="sd">      merged = [[1, 2], [11, 12], [21, 22], [31, 32], [41, 42],</span>
<span class="sd">                [51, 52], [61, 62]]</span>
<span class="sd">  ```</span>

<span class="sd">  This method can be used to merge partitions created by `dynamic_partition`</span>
<span class="sd">  as illustrated on the following example:</span>

<span class="sd">  ```python</span>
<span class="sd">      # Apply function (increments x_i) on elements for which a certain condition</span>
<span class="sd">      # apply (x_i != -1 in this example).</span>
<span class="sd">      x=tf.constant([0.1, -1., 5.2, 4.3, -1., 7.4])</span>
<span class="sd">      condition_mask=tf.not_equal(x,tf.constant(-1.))</span>
<span class="sd">      partitioned_data = tf.dynamic_partition(</span>
<span class="sd">          x, tf.cast(condition_mask, tf.int32) , 2)</span>
<span class="sd">      partitioned_data[1] = partitioned_data[1] + 1.0</span>
<span class="sd">      condition_indices = tf.dynamic_partition(</span>
<span class="sd">          tf.range(tf.shape(x)[0]), tf.cast(condition_mask, tf.int32) , 2)</span>
<span class="sd">      x = tf.dynamic_stitch(condition_indices, partitioned_data)</span>
<span class="sd">      # Here x=[1.1, -1., 6.2, 5.3, -1, 8.4], the -1. values remain</span>
<span class="sd">      # unchanged.</span>
<span class="sd">  ```</span>

<span class="sd">  &lt;div style=&quot;width:70%; margin:auto; margin-bottom:10px; margin-top:20px;&quot;&gt;</span>
<span class="sd">  &lt;img style=&quot;width:100%&quot; src=&quot;https://www.tensorflow.org/images/DynamicStitch.png&quot; alt&gt;</span>
<span class="sd">  &lt;/div&gt;</span>

<span class="sd">  Args:</span>
<span class="sd">    indices: A list of at least 1 `Tensor` objects with type `int32`.</span>
<span class="sd">    data: A list with the same length as `indices` of `Tensor` objects with the same type.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor`. Has the same type as `data`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;DynamicStitch&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dynamic_stitch_eager_fallback</span><span class="p">(</span>
            <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
      <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span>
              <span class="n">dynamic_stitch</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">OpDispatcher</span><span class="o">.</span><span class="n">NOT_SUPPORTED</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">result</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;indices&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">indices</span><span class="p">)</span>
  <span class="n">_attr_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;data&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">_attr_N</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;List argument &#39;data&#39; to &#39;dynamic_stitch&#39; Op with length </span><span class="si">%d</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;must match length </span><span class="si">%d</span><span class="s2"> of argument &#39;indices&#39;.&quot;</span> <span class="o">%</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_attr_N</span><span class="p">))</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;DynamicStitch&quot;</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span>
          <span class="n">dynamic_stitch</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_dispatch</span><span class="o">.</span><span class="n">OpDispatcher</span><span class="o">.</span><span class="n">NOT_SUPPORTED</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">raise</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">),</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;DynamicStitch&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span></div>

<span class="n">DynamicStitch</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.DynamicStitch&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">dynamic_stitch</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">dynamic_stitch_eager_fallback</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;indices&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">indices</span><span class="p">)</span>
  <span class="n">_attr_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;data&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">_attr_N</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;List argument &#39;data&#39; to &#39;dynamic_stitch&#39; Op with length </span><span class="si">%d</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;must match length </span><span class="si">%d</span><span class="s2"> of argument &#39;indices&#39;.&quot;</span> <span class="o">%</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_attr_N</span><span class="p">))</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_n_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">_attr_N</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;DynamicStitch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;DynamicStitch&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">fifo_queue</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements in first-in first-out order.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;fifo_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;FIFOQueue&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                     <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                     <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;FIFOQueue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">FIFOQueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.FIFOQueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">fifo_queue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fifo_queue_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;fifo_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fifo_queue_v2</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements in first-in first-out order.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;FIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fifo_queue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;FIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                       <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                       <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;FIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">FIFOQueueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.FIFOQueueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">fifo_queue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fifo_queue_v2_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
  <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;FIFOQueueV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;FIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">fake_queue</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Do not use.</span>

<span class="sd">  Args:</span>
<span class="sd">    resource: A `Tensor` of type `resource`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;fake_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;FakeQueue&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;FakeQueue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">FakeQueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.FakeQueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">fake_queue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fake_queue_eager_fallback</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;fake_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_session_handle</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Store the input tensor in the state of the current session.</span>

<span class="sd">  Args:</span>
<span class="sd">    value: A `Tensor`. The tensor to be stored.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;GetSessionHandle&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_session_handle_eager_fallback</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandle&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandle&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">GetSessionHandle</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.GetSessionHandle&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">get_session_handle</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_session_handle_eager_fallback</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GetSessionHandle&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandle&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">get_session_handle_v2</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Store the input tensor in the state of the current session.</span>

<span class="sd">  Args:</span>
<span class="sd">    value: A `Tensor`. The tensor to be stored.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;GetSessionHandleV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_session_handle_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandleV2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandleV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">GetSessionHandleV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.GetSessionHandleV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">get_session_handle_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_session_handle_v2_eager_fallback</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GetSessionHandleV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionHandleV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">get_session_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the value of the tensor specified by its handle.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">      The handle for a tensor stored in the session state.</span>
<span class="sd">    dtype: A `tf.DType`. The type of the output value.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;GetSessionTensor&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_session_tensor_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionTensor&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionTensor&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">GetSessionTensor</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.GetSessionTensor&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">get_session_tensor</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_session_tensor_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GetSessionTensor&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;GetSessionTensor&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_clear</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes all elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapClear&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_clear_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapClear&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                    <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                    <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">MapClear</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapClear&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_clear</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_clear_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapClear&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_incomplete_size</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op returns the number of incomplete elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_incomplete_size_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_incomplete_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                             <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                             <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">MapIncompleteSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapIncompleteSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_incomplete_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_incomplete_size_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_incomplete_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapIncompleteSize&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_peek</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op peeks at the values at the specified key.  If the</span>

<span class="sd">  underlying container does not contain this key</span>
<span class="sd">  this op will block until it does.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapPeek&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_peek_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapPeek&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                   <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                   <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapPeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">MapPeek</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapPeek&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_peek</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_peek_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapPeek&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapPeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_size</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op returns the number of elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapSize&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_size_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapSize&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                   <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                   <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">MapSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_size_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapSize&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span>
                             <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_stage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Stage (key, values) in the underlying container which behaves like a hashtable.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`. int64</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    values: A list of `Tensor` objects. a list of tensors</span>
<span class="sd">      dtypes A list of data types that inserted values should adhere to.</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">      Maximum number of elements in the Staging Area. If &gt; 0, inserts</span>
<span class="sd">      on the container will block when the capacity is reached.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container. Otherwise,</span>
<span class="sd">      a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      It is necessary to match this name to the matching Unstage Op.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapStage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span>
        <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
        <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_stage_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
            <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_stage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapStage&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
                    <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                    <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">MapStage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapStage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_stage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_stage_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_stage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_attr_fake_dtypes</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">convert_to_mixed_eager_tensors</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;fake_dtypes&quot;</span><span class="p">,</span> <span class="n">_attr_fake_dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
  <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapStage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">map_unstage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes and returns the values associated with the key</span>

<span class="sd">  from the underlying container.   If the underlying container</span>
<span class="sd">  does not contain this key, the op will block until it does.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapUnstage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_unstage_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstage&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
                      <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                      <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">MapUnstage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapUnstage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_unstage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_unstage_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapUnstage&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_MapUnstageNoKeyOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">map_unstage_no_key</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes and returns a random (key, value)</span>

<span class="sd">  from the underlying container.   If the underlying container</span>
<span class="sd">  does not contain elements, the op will block until it does.</span>

<span class="sd">  Args:</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (key, values).</span>

<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    values: A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_MapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">map_unstage_no_key_eager_fallback</span><span class="p">(</span>
            <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_unstage_no_key&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                           <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                           <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_MapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">MapUnstageNoKey</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.MapUnstageNoKey&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">map_unstage_no_key</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_unstage_no_key_eager_fallback</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;map_unstage_no_key&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;MapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_MapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_clear</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes all elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapClear&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_clear_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapClear&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                           <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                           <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">OrderedMapClear</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapClear&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_clear</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_clear_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapClear&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_incomplete_size</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op returns the number of incomplete elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapIncompleteSize&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_incomplete_size_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_incomplete_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                                    <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                                    <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                    <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">OrderedMapIncompleteSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapIncompleteSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_incomplete_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_incomplete_size_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_incomplete_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapIncompleteSize&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapIncompleteSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_peek</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op peeks at the values at the specified key.  If the</span>

<span class="sd">  underlying container does not contain this key</span>
<span class="sd">  this op will block until it does.   This Op is optimized for</span>
<span class="sd">  performance.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapPeek&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_peek_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapPeek&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
                          <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                          <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
                          <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapPeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">OrderedMapPeek</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapPeek&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_peek</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_peek_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapPeek&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapPeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_size</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op returns the number of elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapSize&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_size_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapSize&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                          <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                          <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">OrderedMapSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_size_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapSize&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_stage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Stage (key, values) in the underlying container which behaves like a ordered</span>

<span class="sd">  associative container.   Elements are ordered by key.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`. int64</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    values: A list of `Tensor` objects. a list of tensors</span>
<span class="sd">      dtypes A list of data types that inserted values should adhere to.</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">      Maximum number of elements in the Staging Area. If &gt; 0, inserts</span>
<span class="sd">      on the container will block when the capacity is reached.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container. Otherwise,</span>
<span class="sd">      a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      It is necessary to match this name to the matching Unstage Op.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapStage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span>
        <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
        <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_stage_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
            <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_stage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapStage&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
                           <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                           <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                           <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">OrderedMapStage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapStage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_stage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_stage_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_stage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_attr_fake_dtypes</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">convert_to_mixed_eager_tensors</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;fake_dtypes&quot;</span><span class="p">,</span> <span class="n">_attr_fake_dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
  <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapStage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">ordered_map_unstage</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes and returns the values associated with the key</span>

<span class="sd">  from the underlying container.   If the underlying container</span>
<span class="sd">  does not contain this key, the op will block until it does.</span>

<span class="sd">  Args:</span>
<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapUnstage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_unstage_eager_fallback</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstage&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
                             <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                             <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">OrderedMapUnstage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapUnstage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_unstage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_unstage_eager_fallback</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapUnstage&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_OrderedMapUnstageNoKeyOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">ordered_map_unstage_no_key</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes and returns the (key, value) element with the smallest</span>

<span class="sd">  key from the underlying container.   If the underlying container</span>
<span class="sd">  does not contain elements, the op will block until it does.</span>

<span class="sd">  Args:</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (key, values).</span>

<span class="sd">    key: A `Tensor` of type `int64`.</span>
<span class="sd">    values: A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_OrderedMapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ordered_map_unstage_no_key_eager_fallback</span><span class="p">(</span>
            <span class="n">indices</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_unstage_no_key&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
                                  <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                                  <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                                  <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                  <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_OrderedMapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">OrderedMapUnstageNoKey</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.OrderedMapUnstageNoKey&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">ordered_map_unstage_no_key</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">ordered_map_unstage_no_key_eager_fallback</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;ordered_map_unstage_no_key&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;OrderedMapUnstageNoKey&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_OrderedMapUnstageNoKeyOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">padding_fifo_queue</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements in first-in first-out order.</span>

<span class="sd">  Variable-size shapes are allowed by setting the corresponding shape dimensions</span>
<span class="sd">  to 0 in the shape attr.  In this case DequeueMany will pad up to the maximum</span>
<span class="sd">  size of any given element in the minibatch.  See below for details.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types.</span>
<span class="sd">      Shapes of fixed rank but variable size are allowed by setting</span>
<span class="sd">      any shape dimension to -1.  In this case, the inputs&#39; shape may vary along</span>
<span class="sd">      the given dimension, and DequeueMany will pad the given dimension with</span>
<span class="sd">      zeros up to the maximum shape of all elements in the given batch.</span>
<span class="sd">      If the length of this attr is 0, different queue elements may have</span>
<span class="sd">      different ranks and shapes, but only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;padding_fifo_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;PaddingFIFOQueue&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                            <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PaddingFIFOQueue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">PaddingFIFOQueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.PaddingFIFOQueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">padding_fifo_queue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">padding_fifo_queue_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;padding_fifo_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">padding_fifo_queue_v2</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements in first-in first-out order.</span>

<span class="sd">  Variable-size shapes are allowed by setting the corresponding shape dimensions</span>
<span class="sd">  to 0 in the shape attr.  In this case DequeueMany will pad up to the maximum</span>
<span class="sd">  size of any given element in the minibatch.  See below for details.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types.</span>
<span class="sd">      Shapes of fixed rank but variable size are allowed by setting</span>
<span class="sd">      any shape dimension to -1.  In this case, the inputs&#39; shape may vary along</span>
<span class="sd">      the given dimension, and DequeueMany will pad the given dimension with</span>
<span class="sd">      zeros up to the maximum shape of all elements in the given batch.</span>
<span class="sd">      If the length of this attr is 0, different queue elements may have</span>
<span class="sd">      different ranks and shapes, but only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;PaddingFIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">padding_fifo_queue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;PaddingFIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                              <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                              <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PaddingFIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">PaddingFIFOQueueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.PaddingFIFOQueueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">padding_fifo_queue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">padding_fifo_queue_v2_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;padding_fifo_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
  <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;PaddingFIFOQueueV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PaddingFIFOQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">parallel_dynamic_stitch</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Interleave the values from the `data` tensors into a single tensor.</span>

<span class="sd">  Builds a merged tensor such that</span>

<span class="sd">  ```python</span>
<span class="sd">      merged[indices[m][i, ..., j], ...] = data[m][i, ..., j, ...]</span>
<span class="sd">  ```</span>

<span class="sd">  For example, if each `indices[m]` is scalar or vector, we have</span>

<span class="sd">  ```python</span>
<span class="sd">      # Scalar indices:</span>
<span class="sd">      merged[indices[m], ...] = data[m][...]</span>

<span class="sd">      # Vector indices:</span>
<span class="sd">      merged[indices[m][i], ...] = data[m][i, ...]</span>
<span class="sd">  ```</span>

<span class="sd">  Each `data[i].shape` must start with the corresponding `indices[i].shape`,</span>
<span class="sd">  and the rest of `data[i].shape` must be constant w.r.t. `i`.  That is, we</span>
<span class="sd">  must have `data[i].shape = indices[i].shape + constant`.  In terms of this</span>
<span class="sd">  `constant`, the output shape is</span>

<span class="sd">      merged.shape = [max(indices)] + constant</span>

<span class="sd">  Values may be merged in parallel, so if an index appears in both `indices[m][i]`</span>
<span class="sd">  and `indices[n][j]`, the result may be invalid. This differs from the normal</span>
<span class="sd">  DynamicStitch operator that defines the behavior in that case.</span>

<span class="sd">  For example:</span>

<span class="sd">  ```python</span>
<span class="sd">      indices[0] = 6</span>
<span class="sd">      indices[1] = [4, 1]</span>
<span class="sd">      indices[2] = [[5, 2], [0, 3]]</span>
<span class="sd">      data[0] = [61, 62]</span>
<span class="sd">      data[1] = [[41, 42], [11, 12]]</span>
<span class="sd">      data[2] = [[[51, 52], [21, 22]], [[1, 2], [31, 32]]]</span>
<span class="sd">      merged = [[1, 2], [11, 12], [21, 22], [31, 32], [41, 42],</span>
<span class="sd">                [51, 52], [61, 62]]</span>
<span class="sd">  ```</span>

<span class="sd">  This method can be used to merge partitions created by `dynamic_partition`</span>
<span class="sd">  as illustrated on the following example:</span>

<span class="sd">  ```python</span>
<span class="sd">      # Apply function (increments x_i) on elements for which a certain condition</span>
<span class="sd">      # apply (x_i != -1 in this example).</span>
<span class="sd">      x=tf.constant([0.1, -1., 5.2, 4.3, -1., 7.4])</span>
<span class="sd">      condition_mask=tf.not_equal(x,tf.constant(-1.))</span>
<span class="sd">      partitioned_data = tf.dynamic_partition(</span>
<span class="sd">          x, tf.cast(condition_mask, tf.int32) , 2)</span>
<span class="sd">      partitioned_data[1] = partitioned_data[1] + 1.0</span>
<span class="sd">      condition_indices = tf.dynamic_partition(</span>
<span class="sd">          tf.range(tf.shape(x)[0]), tf.cast(condition_mask, tf.int32) , 2)</span>
<span class="sd">      x = tf.dynamic_stitch(condition_indices, partitioned_data)</span>
<span class="sd">      # Here x=[1.1, -1., 6.2, 5.3, -1, 8.4], the -1. values remain</span>
<span class="sd">      # unchanged.</span>
<span class="sd">  ```</span>

<span class="sd">  &lt;div style=&quot;width:70%; margin:auto; margin-bottom:10px; margin-top:20px;&quot;&gt;</span>
<span class="sd">  &lt;img style=&quot;width:100%&quot; src=&quot;https://www.tensorflow.org/images/DynamicStitch.png&quot; alt&gt;</span>
<span class="sd">  &lt;/div&gt;</span>

<span class="sd">  Args:</span>
<span class="sd">    indices: A list of at least 1 `Tensor` objects with type `int32`.</span>
<span class="sd">    data: A list with the same length as `indices` of `Tensor` objects with the same type.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor`. Has the same type as `data`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;ParallelDynamicStitch&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parallel_dynamic_stitch_eager_fallback</span><span class="p">(</span>
            <span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;indices&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;parallel_dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">indices</span><span class="p">)</span>
  <span class="n">_attr_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;data&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;parallel_dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">_attr_N</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;List argument &#39;data&#39; to &#39;parallel_dynamic_stitch&#39; Op with length </span><span class="si">%d</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;must match length </span><span class="si">%d</span><span class="s2"> of argument &#39;indices&#39;.&quot;</span> <span class="o">%</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_attr_N</span><span class="p">))</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ParallelDynamicStitch&quot;</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">),</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ParallelDynamicStitch&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">ParallelDynamicStitch</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ParallelDynamicStitch&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">parallel_dynamic_stitch</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">parallel_dynamic_stitch_eager_fallback</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;indices&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;parallel_dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">indices</span><span class="p">)</span>
  <span class="n">_attr_N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;data&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;parallel_dynamic_stitch&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">_attr_N</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="s2">&quot;List argument &#39;data&#39; to &#39;parallel_dynamic_stitch&#39; Op with length </span><span class="si">%d</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;must match length </span><span class="si">%d</span><span class="s2"> of argument &#39;indices&#39;.&quot;</span> <span class="o">%</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">_attr_N</span><span class="p">))</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_n_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">_attr_N</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ParallelDynamicStitch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ParallelDynamicStitch&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">priority_queue</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements sorted by the first component value.</span>

<span class="sd">  Note that the PriorityQueue requires the first component of any element</span>
<span class="sd">  to be a scalar int64, in addition to the other elements declared by</span>
<span class="sd">  component_types.  Therefore calls to Enqueue and EnqueueMany (resp. Dequeue</span>
<span class="sd">  and DequeueMany) on a PriorityQueue will all require (resp. output) one extra</span>
<span class="sd">  entry in their input (resp. output) lists.</span>

<span class="sd">  Args:</span>
<span class="sd">    shapes: A list of shapes (each a `tf.TensorShape` or list of `ints`).</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    component_types: An optional list of `tf.DTypes`. Defaults to `[]`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;priority_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">component_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">component_types</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;PriorityQueue&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                         <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                         <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PriorityQueue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">PriorityQueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.PriorityQueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">priority_queue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">priority_queue_eager_fallback</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;priority_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">priority_queue_v2</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that produces elements sorted by the first component value.</span>

<span class="sd">  Note that the PriorityQueue requires the first component of any element</span>
<span class="sd">  to be a scalar int64, in addition to the other elements declared by</span>
<span class="sd">  component_types.  Therefore calls to Enqueue and EnqueueMany (resp. Dequeue</span>
<span class="sd">  and DequeueMany) on a PriorityQueue will all require (resp. output) one extra</span>
<span class="sd">  entry in their input (resp. output) lists.</span>

<span class="sd">  Args:</span>
<span class="sd">    shapes: A list of shapes (each a `tf.TensorShape` or list of `ints`).</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    component_types: An optional list of `tf.DTypes`. Defaults to `[]`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;PriorityQueueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">priority_queue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">component_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">component_types</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;PriorityQueueV2&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                           <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                           <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PriorityQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">PriorityQueueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.PriorityQueueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">priority_queue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">priority_queue_v2_eager_fallback</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">component_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">component_types</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;priority_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
  <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;PriorityQueueV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;PriorityQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_close</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Closes the given queue.</span>

<span class="sd">  This operation signals that no more elements will be enqueued in the</span>
<span class="sd">  given queue. Subsequent Enqueue(Many) operations will fail.</span>
<span class="sd">  Subsequent Dequeue(Many) operations will continue to succeed if</span>
<span class="sd">  sufficient elements remain in the queue. Subsequent Dequeue(Many)</span>
<span class="sd">  operations that would block will fail immediately.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    cancel_pending_enqueues: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      If true, all pending enqueue requests that are</span>
<span class="sd">      blocked on the given queue will be canceled.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">cancel_pending_enqueues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueClose&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                      <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueClose</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueClose&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_close</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_close_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_close_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Closes the given queue.</span>

<span class="sd">  This operation signals that no more elements will be enqueued in the</span>
<span class="sd">  given queue. Subsequent Enqueue(Many) operations will fail.</span>
<span class="sd">  Subsequent Dequeue(Many) operations will continue to succeed if</span>
<span class="sd">  sufficient elements remain in the queue. Subsequent Dequeue(Many)</span>
<span class="sd">  operations that would block will fail immediately.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    cancel_pending_enqueues: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      If true, all pending enqueue requests that are</span>
<span class="sd">      blocked on the given queue will be canceled.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueCloseV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">,</span>
        <span class="n">cancel_pending_enqueues</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_close_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">cancel_pending_enqueues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueCloseV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                        <span class="n">cancel_pending_enqueues</span><span class="o">=</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueCloseV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueCloseV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_close_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_close_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">cancel_pending_enqueues</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">cancel_pending_enqueues</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">cancel_pending_enqueues</span><span class="p">,</span> <span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;cancel_pending_enqueues&quot;</span><span class="p">,</span> <span class="n">cancel_pending_enqueues</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueCloseV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_dequeue</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues a tuple of one or more tensors from the given queue.</span>

<span class="sd">  This operation has k outputs, where k is the number of components</span>
<span class="sd">  in the tuples stored in the given queue, and output i is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  N.B. If the queue is empty, this operation will block until an element</span>
<span class="sd">  has been dequeued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is empty, this operation will block for up to</span>
<span class="sd">      timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeue&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                        <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_dequeue_many</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues `n` tuples of one or more tensors from the given queue.</span>

<span class="sd">  If the queue is closed and there are fewer than `n` elements, then an</span>
<span class="sd">  OutOfRange error is returned.</span>

<span class="sd">  This operation concatenates queue-element component tensors along the</span>
<span class="sd">  0th dimension to make a single component tensor.  All of the components</span>
<span class="sd">  in the dequeued tuple will have size `n` in the 0th dimension.</span>

<span class="sd">  This operation has `k` outputs, where `k` is the number of components in</span>
<span class="sd">  the tuples stored in the given queue, and output `i` is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  N.B. If the queue is empty, this operation will block until `n` elements</span>
<span class="sd">  have been dequeued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    n: A `Tensor` of type `int32`. The number of tuples to dequeue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue has fewer than n elements, this operation</span>
<span class="sd">      will block for up to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_many&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueMany&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                            <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueMany&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeueMany</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeueMany&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue_many</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_many_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_dequeue_many_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues `n` tuples of one or more tensors from the given queue.</span>

<span class="sd">  If the queue is closed and there are fewer than `n` elements, then an</span>
<span class="sd">  OutOfRange error is returned.</span>

<span class="sd">  This operation concatenates queue-element component tensors along the</span>
<span class="sd">  0th dimension to make a single component tensor.  All of the components</span>
<span class="sd">  in the dequeued tuple will have size `n` in the 0th dimension.</span>

<span class="sd">  This operation has `k` outputs, where `k` is the number of components in</span>
<span class="sd">  the tuples stored in the given queue, and output `i` is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  N.B. If the queue is empty, this operation will block until `n` elements</span>
<span class="sd">  have been dequeued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    n: A `Tensor` of type `int32`. The number of tuples to dequeue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue has fewer than n elements, this operation</span>
<span class="sd">      will block for up to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueDequeueManyV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span>
        <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_dequeue_many_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_many_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueManyV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                              <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                              <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueManyV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeueManyV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeueManyV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue_many_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_many_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_many_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueDequeueManyV2&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">component_types</span><span class="p">),</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueManyV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_dequeue_up_to</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues `n` tuples of one or more tensors from the given queue.</span>

<span class="sd">  This operation is not supported by all queues.  If a queue does not support</span>
<span class="sd">  DequeueUpTo, then an Unimplemented error is returned.</span>

<span class="sd">  If the queue is closed and there are more than 0 but less than `n`</span>
<span class="sd">  elements remaining, then instead of returning an OutOfRange error like</span>
<span class="sd">  QueueDequeueMany, less than `n` elements are returned immediately.  If</span>
<span class="sd">  the queue is closed and there are 0 elements left in the queue, then</span>
<span class="sd">  an OutOfRange error is returned just like in QueueDequeueMany.</span>
<span class="sd">  Otherwise the behavior is identical to QueueDequeueMany:</span>

<span class="sd">  This operation concatenates queue-element component tensors along the</span>
<span class="sd">  0th dimension to make a single component tensor.  All of the components</span>
<span class="sd">  in the dequeued tuple will have size `n` in the 0th dimension.</span>

<span class="sd">  This operation has k outputs, where `k` is the number of components in</span>
<span class="sd">  the tuples stored in the given queue, and output `i` is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    n: A `Tensor` of type `int32`. The number of tuples to dequeue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue has fewer than n elements, this operation</span>
<span class="sd">      will block for up to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue_up_to op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_up_to&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueUpTo&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                            <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueUpTo&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeueUpTo</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeueUpTo&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue_up_to</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_up_to_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_dequeue_up_to op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_dequeue_up_to_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues `n` tuples of one or more tensors from the given queue.</span>

<span class="sd">  This operation is not supported by all queues.  If a queue does not support</span>
<span class="sd">  DequeueUpTo, then an Unimplemented error is returned.</span>

<span class="sd">  If the queue is closed and there are more than 0 but less than `n`</span>
<span class="sd">  elements remaining, then instead of returning an OutOfRange error like</span>
<span class="sd">  QueueDequeueMany, less than `n` elements are returned immediately.  If</span>
<span class="sd">  the queue is closed and there are 0 elements left in the queue, then</span>
<span class="sd">  an OutOfRange error is returned just like in QueueDequeueMany.</span>
<span class="sd">  Otherwise the behavior is identical to QueueDequeueMany:</span>

<span class="sd">  This operation concatenates queue-element component tensors along the</span>
<span class="sd">  0th dimension to make a single component tensor.  All of the components</span>
<span class="sd">  in the dequeued tuple will have size n in the 0th dimension.</span>

<span class="sd">  This operation has `k` outputs, where `k` is the number of components in</span>
<span class="sd">  the tuples stored in the given queue, and output `i` is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    n: A `Tensor` of type `int32`. The number of tuples to dequeue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue has fewer than n elements, this operation</span>
<span class="sd">      will block for up to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueDequeueUpToV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span>
        <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_dequeue_up_to_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_up_to_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueUpToV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                              <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                              <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueUpToV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeueUpToV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeueUpToV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue_up_to_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_up_to_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_up_to_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueDequeueUpToV2&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">component_types</span><span class="p">),</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueUpToV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_dequeue_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Dequeues a tuple of one or more tensors from the given queue.</span>

<span class="sd">  This operation has k outputs, where k is the number of components</span>
<span class="sd">  in the tuples stored in the given queue, and output i is the ith</span>
<span class="sd">  component of the dequeued tuple.</span>

<span class="sd">  N.B. If the queue is empty, this operation will block until an element</span>
<span class="sd">  has been dequeued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a tuple.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is empty, this operation will block for up to</span>
<span class="sd">      timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `component_types`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueDequeueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span>
        <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_dequeue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                          <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span>
              <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;timeout_ms&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueDequeueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueDequeueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_dequeue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_dequeue_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;queue_dequeue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueDequeueV2&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">component_types</span><span class="p">),</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueDequeueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_enqueue</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Enqueues a tuple of one or more tensors in the given queue.</span>

<span class="sd">  The components input has k elements, which correspond to the components of</span>
<span class="sd">  tuples stored in the given queue.</span>

<span class="sd">  N.B. If the queue is full, this operation will block until the given</span>
<span class="sd">  element has been enqueued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    components: A list of `Tensor` objects.</span>
<span class="sd">      One or more tensors from which the enqueued tensors should be taken.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is full, this operation will block for up to</span>
<span class="sd">      timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_enqueue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueEnqueue&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
                        <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueEnqueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueEnqueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_enqueue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_enqueue_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_enqueue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_enqueue_many</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Enqueues zero or more tuples of one or more tensors in the given queue.</span>

<span class="sd">  This operation slices each component tensor along the 0th dimension to</span>
<span class="sd">  make multiple queue elements. All of the tuple components must have the</span>
<span class="sd">  same size in the 0th dimension.</span>

<span class="sd">  The components input has k elements, which correspond to the components of</span>
<span class="sd">  tuples stored in the given queue.</span>

<span class="sd">  N.B. If the queue is full, this operation will block until the given</span>
<span class="sd">  elements have been enqueued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    components: A list of `Tensor` objects.</span>
<span class="sd">      One or more tensors from which the enqueued tensors should</span>
<span class="sd">      be taken.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is too full, this operation will block for up</span>
<span class="sd">      to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_enqueue_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueEnqueueMany&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
                            <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueEnqueueMany</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueEnqueueMany&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_enqueue_many</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_enqueue_many_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_enqueue_many op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_enqueue_many_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Enqueues zero or more tuples of one or more tensors in the given queue.</span>

<span class="sd">  This operation slices each component tensor along the 0th dimension to</span>
<span class="sd">  make multiple queue elements. All of the tuple components must have the</span>
<span class="sd">  same size in the 0th dimension.</span>

<span class="sd">  The components input has k elements, which correspond to the components of</span>
<span class="sd">  tuples stored in the given queue.</span>

<span class="sd">  N.B. If the queue is full, this operation will block until the given</span>
<span class="sd">  elements have been enqueued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    components: A list of `Tensor` objects.</span>
<span class="sd">      One or more tensors from which the enqueued tensors should</span>
<span class="sd">      be taken.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is too full, this operation will block for up</span>
<span class="sd">      to timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueEnqueueManyV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_enqueue_many_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueEnqueueManyV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
                              <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueEnqueueManyV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueEnqueueManyV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_enqueue_many_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_enqueue_many_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_attr_Tcomponents</span><span class="p">,</span> <span class="n">components</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">convert_to_mixed_eager_tensors</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Tcomponents&quot;</span><span class="p">,</span> <span class="n">_attr_Tcomponents</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueEnqueueManyV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_enqueue_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Enqueues a tuple of one or more tensors in the given queue.</span>

<span class="sd">  The components input has k elements, which correspond to the components of</span>
<span class="sd">  tuples stored in the given queue.</span>

<span class="sd">  N.B. If the queue is full, this operation will block until the given</span>
<span class="sd">  element has been enqueued (or &#39;timeout_ms&#39; elapses, if specified).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    components: A list of `Tensor` objects.</span>
<span class="sd">      One or more tensors from which the enqueued tensors should be taken.</span>
<span class="sd">    timeout_ms: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      If the queue is full, this operation will block for up to</span>
<span class="sd">      timeout_ms milliseconds.</span>
<span class="sd">      Note: This option is not supported yet.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueEnqueueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_enqueue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueEnqueueV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
                          <span class="n">timeout_ms</span><span class="o">=</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">QueueEnqueueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueEnqueueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_enqueue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_enqueue_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">timeout_ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">timeout_ms</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">timeout_ms</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">)</span>
  <span class="n">_attr_Tcomponents</span><span class="p">,</span> <span class="n">components</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">convert_to_mixed_eager_tensors</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Tcomponents&quot;</span><span class="p">,</span> <span class="n">_attr_Tcomponents</span><span class="p">,</span> <span class="s2">&quot;timeout_ms&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueEnqueueV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_is_closed</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns true if queue is closed.</span>

<span class="sd">  This operation returns true if the queue is closed and false if the queue</span>
<span class="sd">  is open.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `bool`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_is_closed op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueIsClosed&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueIsClosed&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueIsClosed</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueIsClosed&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_is_closed</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_is_closed_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_is_closed op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_is_closed_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns true if queue is closed.</span>

<span class="sd">  This operation returns true if the queue is closed and false if the queue</span>
<span class="sd">  is open.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `bool`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueIsClosedV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_is_closed_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueIsClosedV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueIsClosedV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueIsClosedV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueIsClosedV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_is_closed_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_is_closed_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueIsClosedV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueIsClosedV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">queue_size</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Computes the number of elements in the given queue.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a queue.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueSize&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_size_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;queue_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">queue_size_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Computes the number of elements in the given queue.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a queue.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;QueueSizeV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">queue_size_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;QueueSizeV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueSizeV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">QueueSizeV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.QueueSizeV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">queue_size_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">queue_size_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;QueueSizeV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;QueueSizeV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">random_shuffle_queue</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that randomizes the order of elements.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    min_after_dequeue: An optional `int`. Defaults to `0`.</span>
<span class="sd">      Dequeue will block unless there would be this</span>
<span class="sd">      many elements after the dequeue or the queue is closed. This</span>
<span class="sd">      ensures a minimum level of mixing of elements.</span>
<span class="sd">    seed: An optional `int`. Defaults to `0`.</span>
<span class="sd">      If either seed or seed2 is set to be non-zero, the random number</span>
<span class="sd">      generator is seeded by the given seed.  Otherwise, a random seed is used.</span>
<span class="sd">    seed2: An optional `int`. Defaults to `0`.</span>
<span class="sd">      A second seed to avoid seed collision.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;random_shuffle_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">min_after_dequeue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">min_after_dequeue</span><span class="p">,</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed2</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed2</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed2</span><span class="p">,</span> <span class="s2">&quot;seed2&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;RandomShuffleQueue&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
                              <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                              <span class="n">min_after_dequeue</span><span class="o">=</span><span class="n">min_after_dequeue</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                              <span class="n">seed2</span><span class="o">=</span><span class="n">seed2</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                              <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">),</span> <span class="s2">&quot;seed&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">),</span> <span class="s2">&quot;seed2&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;seed2&quot;</span><span class="p">),</span>
              <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;RandomShuffleQueue&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">RandomShuffleQueue</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.RandomShuffleQueue&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">random_shuffle_queue</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">random_shuffle_queue_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">seed2</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;random_shuffle_queue op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">random_shuffle_queue_v2</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="p">[],</span> <span class="n">capacity</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A queue that randomizes the order of elements.</span>

<span class="sd">  Args:</span>
<span class="sd">    component_types: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">      The type of each component in a value.</span>
<span class="sd">    shapes: An optional list of shapes (each a `tf.TensorShape` or list of `ints`). Defaults to `[]`.</span>
<span class="sd">      The shape of each component in a value. The length of this attr must</span>
<span class="sd">      be either 0 or the same as the length of component_types. If the length of</span>
<span class="sd">      this attr is 0, the shapes of queue elements are not constrained, and</span>
<span class="sd">      only one element may be dequeued at a time.</span>
<span class="sd">    capacity: An optional `int`. Defaults to `-1`.</span>
<span class="sd">      The upper bound on the number of elements in this queue.</span>
<span class="sd">      Negative numbers mean no limit.</span>
<span class="sd">    min_after_dequeue: An optional `int`. Defaults to `0`.</span>
<span class="sd">      Dequeue will block unless there would be this</span>
<span class="sd">      many elements after the dequeue or the queue is closed. This</span>
<span class="sd">      ensures a minimum level of mixing of elements.</span>
<span class="sd">    seed: An optional `int`. Defaults to `0`.</span>
<span class="sd">      If either seed or seed2 is set to be non-zero, the random number</span>
<span class="sd">      generator is seeded by the given seed.  Otherwise, a random seed is used.</span>
<span class="sd">    seed2: An optional `int`. Defaults to `0`.</span>
<span class="sd">      A second seed to avoid seed collision.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;RandomShuffleQueueV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
        <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="s2">&quot;seed2&quot;</span><span class="p">,</span> <span class="n">seed2</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">random_shuffle_queue_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
            <span class="n">min_after_dequeue</span><span class="o">=</span><span class="n">min_after_dequeue</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">seed2</span><span class="o">=</span><span class="n">seed2</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">min_after_dequeue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">min_after_dequeue</span><span class="p">,</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed2</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed2</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed2</span><span class="p">,</span> <span class="s2">&quot;seed2&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;RandomShuffleQueueV2&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="o">=</span><span class="n">component_types</span><span class="p">,</span>
                                <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                                <span class="n">min_after_dequeue</span><span class="o">=</span><span class="n">min_after_dequeue</span><span class="p">,</span>
                                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">seed2</span><span class="o">=</span><span class="n">seed2</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">),</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shapes&quot;</span><span class="p">),</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">),</span> <span class="s2">&quot;seed&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;seed&quot;</span><span class="p">),</span> <span class="s2">&quot;seed2&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;seed2&quot;</span><span class="p">),</span>
              <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;RandomShuffleQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">RandomShuffleQueueV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.RandomShuffleQueueV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">random_shuffle_queue_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">random_shuffle_queue_v2_eager_fallback</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">seed2</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;component_types&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">component_types</span><span class="p">)</span>
  <span class="n">component_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;component_types&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">component_types</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;shapes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;random_shuffle_queue_v2&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">shapes</span><span class="p">)</span>
  <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">_s</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">min_after_dequeue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">min_after_dequeue</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">min_after_dequeue</span><span class="p">,</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">seed2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">seed2</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">seed2</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">seed2</span><span class="p">,</span> <span class="s2">&quot;seed2&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;component_types&quot;</span><span class="p">,</span> <span class="n">component_types</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span>
  <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;min_after_dequeue&quot;</span><span class="p">,</span> <span class="n">min_after_dequeue</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="s2">&quot;seed2&quot;</span><span class="p">,</span>
  <span class="n">seed2</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;RandomShuffleQueueV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;RandomShuffleQueueV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">record_input</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">,</span> <span class="n">file_random_seed</span><span class="o">=</span><span class="mi">301</span><span class="p">,</span> <span class="n">file_shuffle_shift_ratio</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_buffer_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">file_parallelism</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">compression_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Emits randomized records.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_pattern: A `string`. Glob pattern for the data files.</span>
<span class="sd">    file_random_seed: An optional `int`. Defaults to `301`.</span>
<span class="sd">      Random seeds used to produce randomized records.</span>
<span class="sd">    file_shuffle_shift_ratio: An optional `float`. Defaults to `0`.</span>
<span class="sd">      Shifts the list of files after the list is randomly</span>
<span class="sd">      shuffled.</span>
<span class="sd">    file_buffer_size: An optional `int`. Defaults to `10000`.</span>
<span class="sd">      The randomization shuffling buffer.</span>
<span class="sd">    file_parallelism: An optional `int`. Defaults to `16`.</span>
<span class="sd">      How many sstables are opened and concurrently iterated over.</span>
<span class="sd">    batch_size: An optional `int`. Defaults to `32`. The batch size.</span>
<span class="sd">    compression_type: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      The type of compression for the file. Currently ZLIB and</span>
<span class="sd">      GZIP are supported. Defaults to none.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;RecordInput&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;file_pattern&quot;</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="s2">&quot;file_random_seed&quot;</span><span class="p">,</span>
        <span class="n">file_random_seed</span><span class="p">,</span> <span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">,</span>
        <span class="n">file_shuffle_shift_ratio</span><span class="p">,</span> <span class="s2">&quot;file_buffer_size&quot;</span><span class="p">,</span> <span class="n">file_buffer_size</span><span class="p">,</span>
        <span class="s2">&quot;file_parallelism&quot;</span><span class="p">,</span> <span class="n">file_parallelism</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span>
        <span class="s2">&quot;compression_type&quot;</span><span class="p">,</span> <span class="n">compression_type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">record_input_eager_fallback</span><span class="p">(</span>
            <span class="n">file_pattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">,</span> <span class="n">file_random_seed</span><span class="o">=</span><span class="n">file_random_seed</span><span class="p">,</span>
            <span class="n">file_shuffle_shift_ratio</span><span class="o">=</span><span class="n">file_shuffle_shift_ratio</span><span class="p">,</span>
            <span class="n">file_buffer_size</span><span class="o">=</span><span class="n">file_buffer_size</span><span class="p">,</span>
            <span class="n">file_parallelism</span><span class="o">=</span><span class="n">file_parallelism</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">compression_type</span><span class="o">=</span><span class="n">compression_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">file_pattern</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">,</span> <span class="s2">&quot;file_pattern&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_random_seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_random_seed</span> <span class="o">=</span> <span class="mi">301</span>
  <span class="n">file_random_seed</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_random_seed</span><span class="p">,</span> <span class="s2">&quot;file_random_seed&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_shuffle_shift_ratio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_shuffle_shift_ratio</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">file_shuffle_shift_ratio</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_float</span><span class="p">(</span><span class="n">file_shuffle_shift_ratio</span><span class="p">,</span> <span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_buffer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_buffer_size</span> <span class="o">=</span> <span class="mi">10000</span>
  <span class="n">file_buffer_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_buffer_size</span><span class="p">,</span> <span class="s2">&quot;file_buffer_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_parallelism</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_parallelism</span> <span class="o">=</span> <span class="mi">16</span>
  <span class="n">file_parallelism</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_parallelism</span><span class="p">,</span> <span class="s2">&quot;file_parallelism&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
  <span class="n">batch_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">compression_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">compression_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">compression_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">compression_type</span><span class="p">,</span> <span class="s2">&quot;compression_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;RecordInput&quot;</span><span class="p">,</span> <span class="n">file_pattern</span><span class="o">=</span><span class="n">file_pattern</span><span class="p">,</span>
                       <span class="n">file_random_seed</span><span class="o">=</span><span class="n">file_random_seed</span><span class="p">,</span>
                       <span class="n">file_shuffle_shift_ratio</span><span class="o">=</span><span class="n">file_shuffle_shift_ratio</span><span class="p">,</span>
                       <span class="n">file_buffer_size</span><span class="o">=</span><span class="n">file_buffer_size</span><span class="p">,</span>
                       <span class="n">file_parallelism</span><span class="o">=</span><span class="n">file_parallelism</span><span class="p">,</span>
                       <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                       <span class="n">compression_type</span><span class="o">=</span><span class="n">compression_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;file_pattern&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;file_pattern&quot;</span><span class="p">),</span>
              <span class="s2">&quot;file_random_seed&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;file_random_seed&quot;</span><span class="p">),</span>
              <span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">),</span> <span class="s2">&quot;file_buffer_size&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;file_buffer_size&quot;</span><span class="p">),</span> <span class="s2">&quot;file_parallelism&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;file_parallelism&quot;</span><span class="p">),</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">),</span> <span class="s2">&quot;compression_type&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;compression_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;RecordInput&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">RecordInput</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.RecordInput&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">record_input</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">record_input_eager_fallback</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">,</span> <span class="n">file_random_seed</span><span class="p">,</span> <span class="n">file_shuffle_shift_ratio</span><span class="p">,</span> <span class="n">file_buffer_size</span><span class="p">,</span> <span class="n">file_parallelism</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">compression_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">file_pattern</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">,</span> <span class="s2">&quot;file_pattern&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_random_seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_random_seed</span> <span class="o">=</span> <span class="mi">301</span>
  <span class="n">file_random_seed</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_random_seed</span><span class="p">,</span> <span class="s2">&quot;file_random_seed&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_shuffle_shift_ratio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_shuffle_shift_ratio</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">file_shuffle_shift_ratio</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_float</span><span class="p">(</span><span class="n">file_shuffle_shift_ratio</span><span class="p">,</span> <span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_buffer_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_buffer_size</span> <span class="o">=</span> <span class="mi">10000</span>
  <span class="n">file_buffer_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_buffer_size</span><span class="p">,</span> <span class="s2">&quot;file_buffer_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_parallelism</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_parallelism</span> <span class="o">=</span> <span class="mi">16</span>
  <span class="n">file_parallelism</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">file_parallelism</span><span class="p">,</span> <span class="s2">&quot;file_parallelism&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
  <span class="n">batch_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">compression_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">compression_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">compression_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">compression_type</span><span class="p">,</span> <span class="s2">&quot;compression_type&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;file_pattern&quot;</span><span class="p">,</span> <span class="n">file_pattern</span><span class="p">,</span> <span class="s2">&quot;file_random_seed&quot;</span><span class="p">,</span>
  <span class="n">file_random_seed</span><span class="p">,</span> <span class="s2">&quot;file_shuffle_shift_ratio&quot;</span><span class="p">,</span> <span class="n">file_shuffle_shift_ratio</span><span class="p">,</span>
  <span class="s2">&quot;file_buffer_size&quot;</span><span class="p">,</span> <span class="n">file_buffer_size</span><span class="p">,</span> <span class="s2">&quot;file_parallelism&quot;</span><span class="p">,</span> <span class="n">file_parallelism</span><span class="p">,</span>
  <span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="s2">&quot;compression_type&quot;</span><span class="p">,</span> <span class="n">compression_type</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;RecordInput&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;RecordInput&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">resource_accumulator_apply_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Applies a gradient to a given accumulator.</span>

<span class="sd">  Does not add if local_step is lesser than the accumulator&#39;s global_step.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a accumulator.</span>
<span class="sd">    local_step: A `Tensor` of type `int64`.</span>
<span class="sd">      The local_step value at which the gradient was computed.</span>
<span class="sd">    gradient: A `Tensor`. Must be one of the following types: `float32`, `float64`, `int32`, `uint8`, `int16`, `int8`, `complex64`, `int64`, `qint8`, `quint8`, `qint32`, `bfloat16`, `uint16`, `complex128`, `half`, `uint32`, `uint64`.</span>
<span class="sd">      A tensor of the gradient to be accumulated.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;ResourceAccumulatorApplyGradient&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span>
        <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resource_accumulator_apply_gradient_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorApplyGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                            <span class="n">local_step</span><span class="o">=</span><span class="n">local_step</span><span class="p">,</span>
                                            <span class="n">gradient</span><span class="o">=</span><span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">ResourceAccumulatorApplyGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ResourceAccumulatorApplyGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">resource_accumulator_apply_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">resource_accumulator_apply_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">gradient</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">gradient</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">local_step</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">local_step</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_attr_dtype</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ResourceAccumulatorApplyGradient&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">resource_accumulator_num_accumulated</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Returns the number of gradients aggregated in the given accumulators.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to an accumulator.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;ResourceAccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resource_accumulator_num_accumulated_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">ResourceAccumulatorNumAccumulated</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ResourceAccumulatorNumAccumulated&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">resource_accumulator_num_accumulated</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">resource_accumulator_num_accumulated_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ResourceAccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorNumAccumulated&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">resource_accumulator_set_global_step</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Updates the accumulator with a new value for global_step.</span>

<span class="sd">  Logs warning if the accumulator&#39;s value is already higher than</span>
<span class="sd">  new_global_step.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to an accumulator.</span>
<span class="sd">    new_global_step: A `Tensor` of type `int64`.</span>
<span class="sd">      The new global_step value to set.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;ResourceAccumulatorSetGlobalStep&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span>
        <span class="n">new_global_step</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resource_accumulator_set_global_step_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorSetGlobalStep&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                            <span class="n">new_global_step</span><span class="o">=</span><span class="n">new_global_step</span><span class="p">,</span>
                                            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">ResourceAccumulatorSetGlobalStep</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ResourceAccumulatorSetGlobalStep&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">resource_accumulator_set_global_step</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">resource_accumulator_set_global_step_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">new_global_step</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">new_global_step</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">new_global_step</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ResourceAccumulatorSetGlobalStep&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">resource_accumulator_take_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extracts the average gradient in the given ConditionalAccumulator.</span>

<span class="sd">  The op blocks until sufficient (i.e., more than num_required)</span>
<span class="sd">  gradients have been accumulated.  If the accumulator has already</span>
<span class="sd">  aggregated more than num_required gradients, it returns the average of</span>
<span class="sd">  the accumulated gradients.  Also automatically increments the recorded</span>
<span class="sd">  global_step in the accumulator by 1, and resets the aggregate to 0.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to an accumulator.</span>
<span class="sd">    num_required: A `Tensor` of type `int32`.</span>
<span class="sd">      Number of gradients required before we return an aggregate.</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The data type of accumulated gradients. Needs to correspond to the type</span>
<span class="sd">      of the accumulator.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;ResourceAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span>
        <span class="n">num_required</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resource_accumulator_take_gradient_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                           <span class="n">num_required</span><span class="o">=</span><span class="n">num_required</span><span class="p">,</span>
                                           <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">ResourceAccumulatorTakeGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ResourceAccumulatorTakeGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">resource_accumulator_take_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">resource_accumulator_take_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">num_required</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">num_required</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ResourceAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">resource_conditional_accumulator</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">reduction_type</span><span class="o">=</span><span class="s2">&quot;MEAN&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A conditional accumulator for aggregating gradients.</span>

<span class="sd">  The accumulator accepts gradients marked with local_step greater or</span>
<span class="sd">  equal to the most recent global_step known to the accumulator. The</span>
<span class="sd">  average can be extracted from the accumulator, provided sufficient</span>
<span class="sd">  gradients have been accumulated. Extracting the average automatically</span>
<span class="sd">  resets the aggregate to 0, and increments the global_step recorded by</span>
<span class="sd">  the accumulator.</span>
<span class="sd">  This is a resource version of ConditionalAccumulator that will work in TF2.0</span>
<span class="sd">  with tf.cond version 2.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The type of the value being accumulated.</span>
<span class="sd">    shape: A `tf.TensorShape` or list of `ints`.</span>
<span class="sd">      The shape of the values, can be [], in which case shape is unknown.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator will be shared under the</span>
<span class="sd">      given name across multiple sessions.</span>
<span class="sd">    reduction_type: An optional `string` from: `&quot;MEAN&quot;, &quot;SUM&quot;`. Defaults to `&quot;MEAN&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;ResourceConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">,</span> <span class="n">reduction_type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">resource_conditional_accumulator_eager_fallback</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
            <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">reduction_type</span><span class="o">=</span><span class="n">reduction_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">reduction_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reduction_type</span> <span class="o">=</span> <span class="s2">&quot;MEAN&quot;</span>
  <span class="n">reduction_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">reduction_type</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;ResourceConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                          <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                          <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
                                          <span class="n">reduction_type</span><span class="o">=</span><span class="n">reduction_type</span><span class="p">,</span>
                                          <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">),</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;reduction_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">ResourceConditionalAccumulator</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.ResourceConditionalAccumulator&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">resource_conditional_accumulator</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">resource_conditional_accumulator_eager_fallback</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">reduction_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">reduction_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reduction_type</span> <span class="o">=</span> <span class="s2">&quot;MEAN&quot;</span>
  <span class="n">reduction_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">reduction_type</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
  <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">,</span> <span class="n">reduction_type</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ResourceConditionalAccumulator&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;ResourceConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">sparse_accumulator_apply_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient_indices</span><span class="p">,</span> <span class="n">gradient_values</span><span class="p">,</span> <span class="n">gradient_shape</span><span class="p">,</span> <span class="n">has_known_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Applies a sparse gradient to a given accumulator.</span>

<span class="sd">  Does not add if local_step is smaller than the accumulator&#39;s</span>
<span class="sd">  global_step.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`. The handle to a accumulator.</span>
<span class="sd">    local_step: A `Tensor` of type `int64`.</span>
<span class="sd">      The local_step value at which the sparse gradient was computed.</span>
<span class="sd">    gradient_indices: A `Tensor` of type `int64`.</span>
<span class="sd">      Indices of the sparse gradient to be accumulated. Must be a</span>
<span class="sd">      vector.</span>
<span class="sd">    gradient_values: A `Tensor`. Must be one of the following types: `float32`, `float64`, `int32`, `uint8`, `int16`, `int8`, `complex64`, `int64`, `qint8`, `quint8`, `qint32`, `bfloat16`, `uint16`, `complex128`, `half`, `uint32`, `uint64`.</span>
<span class="sd">      Values are the non-zero slices of the gradient, and must have</span>
<span class="sd">      the same first dimension as indices, i.e., the nnz represented by indices and</span>
<span class="sd">      values must be consistent.</span>
<span class="sd">    gradient_shape: A `Tensor` of type `int64`.</span>
<span class="sd">      Shape of the sparse gradient to be accumulated.</span>
<span class="sd">    has_known_shape: A `bool`.</span>
<span class="sd">      Boolean indicating whether gradient_shape is unknown, in which</span>
<span class="sd">      case the input is ignored during validation.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_accumulator_apply_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">has_known_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">has_known_shape</span><span class="p">,</span> <span class="s2">&quot;has_known_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;SparseAccumulatorApplyGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                          <span class="n">local_step</span><span class="o">=</span><span class="n">local_step</span><span class="p">,</span>
                                          <span class="n">gradient_indices</span><span class="o">=</span><span class="n">gradient_indices</span><span class="p">,</span>
                                          <span class="n">gradient_values</span><span class="o">=</span><span class="n">gradient_values</span><span class="p">,</span>
                                          <span class="n">gradient_shape</span><span class="o">=</span><span class="n">gradient_shape</span><span class="p">,</span>
                                          <span class="n">has_known_shape</span><span class="o">=</span><span class="n">has_known_shape</span><span class="p">,</span>
                                          <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">SparseAccumulatorApplyGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.SparseAccumulatorApplyGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">sparse_accumulator_apply_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">sparse_accumulator_apply_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">local_step</span><span class="p">,</span> <span class="n">gradient_indices</span><span class="p">,</span> <span class="n">gradient_values</span><span class="p">,</span> <span class="n">gradient_shape</span><span class="p">,</span> <span class="n">has_known_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_accumulator_apply_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
<span class="n">_SparseAccumulatorTakeGradientOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;SparseAccumulatorTakeGradient&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">sparse_accumulator_take_gradient</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extracts the average sparse gradient in a SparseConditionalAccumulator.</span>

<span class="sd">  The op will blocks until sufficient (i.e., more than num_required)</span>
<span class="sd">  gradients have been accumulated. If the accumulator has already</span>
<span class="sd">  aggregated more than num_required gradients, it will return its</span>
<span class="sd">  average of the accumulated gradients.  Also automatically increments</span>
<span class="sd">  the recorded global_step in the accumulator by 1, and resets the</span>
<span class="sd">  aggregate to 0.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">      The handle to a SparseConditionalAccumulator.</span>
<span class="sd">    num_required: A `Tensor` of type `int32`.</span>
<span class="sd">      Number of gradients required before we return an aggregate.</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The data type of accumulated gradients. Needs to correspond to the type</span>
<span class="sd">      of the accumulator.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (indices, values, shape).</span>

<span class="sd">    indices: A `Tensor` of type `int64`.</span>
<span class="sd">    values: A `Tensor` of type `dtype`.</span>
<span class="sd">    shape: A `Tensor` of type `int64`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_accumulator_take_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;SparseAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span>
                                         <span class="n">num_required</span><span class="o">=</span><span class="n">num_required</span><span class="p">,</span>
                                         <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;SparseAccumulatorTakeGradient&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_SparseAccumulatorTakeGradientOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">SparseAccumulatorTakeGradient</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.SparseAccumulatorTakeGradient&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">sparse_accumulator_take_gradient</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">sparse_accumulator_take_gradient_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">num_required</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_accumulator_take_gradient op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sparse_conditional_accumulator</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">reduction_type</span><span class="o">=</span><span class="s2">&quot;MEAN&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A conditional accumulator for aggregating sparse gradients.</span>

<span class="sd">  The accumulator accepts gradients marked with local_step greater or</span>
<span class="sd">  equal to the most recent global_step known to the accumulator. The</span>
<span class="sd">  average can be extracted from the accumulator, provided sufficient</span>
<span class="sd">  gradients have been accumulated. Extracting the average automatically</span>
<span class="sd">  resets the aggregate to 0, and increments the global_step recorded by</span>
<span class="sd">  the accumulator.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtype: A `tf.DType` from: `tf.float32, tf.float64, tf.int32, tf.uint8, tf.int16, tf.int8, tf.complex64, tf.int64, tf.qint8, tf.quint8, tf.qint32, tf.bfloat16, tf.uint16, tf.complex128, tf.half, tf.uint32, tf.uint64`.</span>
<span class="sd">      The type of the value being accumulated.</span>
<span class="sd">    shape: A `tf.TensorShape` or list of `ints`. The shape of the values.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator is placed in the given container.</span>
<span class="sd">      Otherwise, a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this accumulator will be shared under the given name</span>
<span class="sd">      across multiple sessions.</span>
<span class="sd">    reduction_type: An optional `string` from: `&quot;MEAN&quot;, &quot;SUM&quot;`. Defaults to `&quot;MEAN&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_conditional_accumulator op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">reduction_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reduction_type</span> <span class="o">=</span> <span class="s2">&quot;MEAN&quot;</span>
  <span class="n">reduction_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">reduction_type</span><span class="p">,</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;SparseConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
                                        <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                        <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
                                        <span class="n">reduction_type</span><span class="o">=</span><span class="n">reduction_type</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">),</span> <span class="s2">&quot;reduction_type&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;reduction_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;SparseConditionalAccumulator&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">SparseConditionalAccumulator</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.SparseConditionalAccumulator&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">sparse_conditional_accumulator</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">sparse_conditional_accumulator_eager_fallback</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">reduction_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;sparse_conditional_accumulator op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_stack</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated, use StackV2.</span>

<span class="sd">  Args:</span>
<span class="sd">    elem_type: A `tf.DType`.</span>
<span class="sd">    stack_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">stack_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">stack_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">stack_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;Stack&quot;</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="o">=</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">),</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;stack_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;Stack&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">Stack</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.Stack&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">_stack</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_stack_eager_fallback</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stack_close</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated, use StackCloseV2.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackClose&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">StackClose</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackClose&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_close</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_close_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stack_close_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Delete the stack from its resource container.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a stack.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StackCloseV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stack_close_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackCloseV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">StackCloseV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackCloseV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_close_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_close_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StackCloseV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stack_pop</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated, use StackPopV2.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    elem_type: A `tf.DType`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `elem_type`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_pop op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackPop&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPop&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StackPop</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackPop&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_pop</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_pop_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_pop op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stack_pop_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Pop the element at the top of the stack.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a stack.</span>
<span class="sd">    elem_type: A `tf.DType`. The type of the elem that is popped.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `elem_type`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StackPopV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stack_pop_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackPopV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPopV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StackPopV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackPopV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_pop_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_pop_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StackPopV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPopV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stack_push</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated, use StackPushV2.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    elem: A `Tensor`.</span>
<span class="sd">    swap_memory: An optional `bool`. Defaults to `False`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor`. Has the same type as `elem`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_push op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">swap_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">swap_memory</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">swap_memory</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">swap_memory</span><span class="p">,</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackPush&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="o">=</span><span class="n">swap_memory</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;swap_memory&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPush&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StackPush</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackPush&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_push</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_push_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;stack_push op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stack_push_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Push an element onto the stack.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a stack.</span>
<span class="sd">    elem: A `Tensor`. The tensor to be pushed onto the stack.</span>
<span class="sd">    swap_memory: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      Swap `elem` to CPU. Default to false.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor`. Has the same type as `elem`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StackPushV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">,</span> <span class="n">swap_memory</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stack_push_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="o">=</span><span class="n">swap_memory</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">swap_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">swap_memory</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">swap_memory</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">swap_memory</span><span class="p">,</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackPushV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="o">=</span><span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="o">=</span><span class="n">swap_memory</span><span class="p">,</span>
                       <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;swap_memory&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPushV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StackPushV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackPushV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_push_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_push_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">swap_memory</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">swap_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">swap_memory</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">swap_memory</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">swap_memory</span><span class="p">,</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">)</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">elem</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">elem</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">elem</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">,</span> <span class="s2">&quot;swap_memory&quot;</span><span class="p">,</span> <span class="n">swap_memory</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StackPushV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackPushV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stack_v2</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A stack that produces elements in first-in last-out order.</span>

<span class="sd">  Args:</span>
<span class="sd">    max_size: A `Tensor` of type `int32`.</span>
<span class="sd">      The maximum size of the stack if non-negative. If negative, the stack</span>
<span class="sd">      size is unlimited.</span>
<span class="sd">    elem_type: A `tf.DType`. The type of the elements on the stack.</span>
<span class="sd">    stack_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      Overrides the name used for the temporary stack resource. Default</span>
<span class="sd">      value is the name of the &#39;Stack&#39; op (which is guaranteed unique).</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `resource`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StackV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">,</span>
        <span class="n">stack_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stack_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">max_size</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="o">=</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">stack_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">stack_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">stack_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StackV2&quot;</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">,</span> <span class="n">elem_type</span><span class="o">=</span><span class="n">elem_type</span><span class="p">,</span>
                   <span class="n">stack_name</span><span class="o">=</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">),</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;stack_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StackV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StackV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stack_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stack_v2_eager_fallback</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">elem_type</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;elem_type&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">stack_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">stack_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">stack_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">)</span>
  <span class="n">max_size</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_size</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;elem_type&quot;</span><span class="p">,</span> <span class="n">elem_type</span><span class="p">,</span> <span class="s2">&quot;stack_name&quot;</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StackV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span>
                             <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StackV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stage</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Stage values similar to a lightweight Enqueue.</span>

<span class="sd">  The basic functionality of this Op is similar to a queue with many</span>
<span class="sd">  fewer capabilities and options.  This Op is optimized for performance.</span>

<span class="sd">  Args:</span>
<span class="sd">    values: A list of `Tensor` objects. a list of tensors</span>
<span class="sd">      dtypes A list of data types that inserted values should adhere to.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">      Maximum number of elements in the Staging Area. If &gt; 0, inserts</span>
<span class="sd">      on the container will block when the capacity is reached.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">      The maximum number of bytes allowed for Tensors in the Staging Area.</span>
<span class="sd">      If &gt; 0, inserts will block until sufficient space is available.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      If non-empty, this queue is placed in the given container. Otherwise,</span>
<span class="sd">      a default container is used.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      It is necessary to match this name to the matching Unstage Op.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;Stage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stage_eager_fallback</span><span class="p">(</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;Stage&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
                 <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">Stage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.Stage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stage_eager_fallback</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_attr_dtypes</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">convert_to_mixed_eager_tensors</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">_attr_dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Stage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span>
                             <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stage_clear</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op removes all elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StageClear&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stage_clear_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StageClear&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                      <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                      <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">StageClear</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StageClear&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stage_clear</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stage_clear_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_clear&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StageClear&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stage_peek</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op peeks at the values at the specified index.  If the</span>

<span class="sd">  underlying container does not contain sufficient elements</span>
<span class="sd">  this op will block until it does.   This Op is optimized for</span>
<span class="sd">  performance.</span>

<span class="sd">  Args:</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StagePeek&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span>
        <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stage_peek_eager_fallback</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span>
            <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StagePeek&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                     <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                     <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StagePeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StagePeek</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StagePeek&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stage_peek</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stage_peek_eager_fallback</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_peek&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StagePeek&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StagePeek&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">stage_size</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op returns the number of elements in the underlying container.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;StageSize&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stage_size_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;StageSize&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                     <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                     <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StageSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">StageSize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.StageSize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">stage_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">stage_size_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;stage_size&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;StageSize&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;StageSize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    size: A `Tensor` of type `int32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    dynamic_size: An optional `bool`. Defaults to `False`.</span>
<span class="sd">    clear_after_read: An optional `bool`. Defaults to `True`.</span>
<span class="sd">    tensor_array_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">dynamic_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">dynamic_size</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">dynamic_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">clear_after_read</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clear_after_read</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">clear_after_read</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tensor_array_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArray&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="o">=</span><span class="n">dynamic_size</span><span class="p">,</span>
                       <span class="n">clear_after_read</span><span class="o">=</span><span class="n">clear_after_read</span><span class="p">,</span>
                       <span class="n">tensor_array_name</span><span class="o">=</span><span class="n">tensor_array_name</span><span class="p">,</span>
                       <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;dynamic_size&quot;</span><span class="p">),</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;clear_after_read&quot;</span><span class="p">),</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;tensor_array_name&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArray&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArray</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArray&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_eager_fallback</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_close</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayClose&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">TensorArrayClose</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayClose&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_close</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_close_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_close op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_close_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayCloseV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayCloseV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_close_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayCloseV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">TensorArrayCloseV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayCloseV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_close_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_close_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayCloseV2&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_close_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Delete the TensorArray from its resource container.</span>

<span class="sd">  This enables the user to close and release the resource in the middle</span>
<span class="sd">  of a step/run.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`.</span>
<span class="sd">      The handle to a TensorArray (output of TensorArray or TensorArrayGrad).</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    The created Operation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayCloseV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_close_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayCloseV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_op</span>
<span class="n">TensorArrayCloseV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayCloseV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_close_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_close_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayCloseV3&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_TensorArrayConcatOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayConcat&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;lengths&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_concat</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape_except0: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (value, lengths).</span>

<span class="sd">    value: A `Tensor` of type `dtype`.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_concat op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape_except0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcat&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                             <span class="n">element_shape_except0</span><span class="o">=</span><span class="n">element_shape_except0</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape_except0&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcat&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayConcat</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayConcat&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_concat</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_concat_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_concat op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
<span class="n">_TensorArrayConcatV2Output</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;lengths&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_concat_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayConcatV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape_except0: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (value, lengths).</span>

<span class="sd">    value: A `Tensor` of type `dtype`.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
        <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV2Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_concat_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">element_shape_except0</span><span class="o">=</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape_except0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                               <span class="n">element_shape_except0</span><span class="o">=</span><span class="n">element_shape_except0</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape_except0&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV2Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayConcatV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayConcatV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_concat_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_concat_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape_except0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV2Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_TensorArrayConcatV3Output</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;lengths&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_concat_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Concat the elements from the TensorArray into value `value`.</span>

<span class="sd">  Takes `T` elements of shapes</span>

<span class="sd">    ```</span>
<span class="sd">    (n0 x d0 x d1 x ...), (n1 x d0 x d1 x ...), ..., (n(T-1) x d0 x d1 x ...)</span>
<span class="sd">    ```</span>

<span class="sd">  and concatenates them into a Tensor of shape:</span>

<span class="sd">    ```(n0 + n1 + ... + n(T-1) x d0 x d1 x ...)```</span>

<span class="sd">  All elements must have the same shape (excepting the first dimension).</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    dtype: A `tf.DType`. The type of the elem that is returned.</span>
<span class="sd">    element_shape_except0: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">      The expected shape of an element, if known,</span>
<span class="sd">      excluding the first dimension. Used to validate the shapes of</span>
<span class="sd">      TensorArray elements. If this shape is not fully specified, concatenating</span>
<span class="sd">      zero-size TensorArrays is an error.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (value, lengths).</span>

<span class="sd">    value: A `Tensor` of type `dtype`.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
        <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_concat_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">element_shape_except0</span><span class="o">=</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape_except0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                               <span class="n">element_shape_except0</span><span class="o">=</span><span class="n">element_shape_except0</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape_except0&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayConcatV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayConcatV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_concat_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_concat_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape_except0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape_except0</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape_except0</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape_except0&quot;</span><span class="p">,</span> <span class="n">element_shape_except0</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayConcatV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayConcatV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_gather</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_gather op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGather&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGather&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGather</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGather&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_gather</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_gather_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_gather op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_gather_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayGatherV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayGatherV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
        <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_gather_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                               <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                               <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGatherV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGatherV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_gather_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_gather_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayGatherV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_gather_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Gather specific elements from the TensorArray into output `value`.</span>

<span class="sd">  All elements selected by `indices` must have the same shape.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">      The locations in the TensorArray from which to read tensor elements.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    dtype: A `tf.DType`. The type of the elem that is returned.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">      The expected shape of an element, if known. Used to</span>
<span class="sd">      validate the shapes of TensorArray elements. If this shape is not</span>
<span class="sd">      fully specified, gathering zero-size TensorArrays is an error.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayGatherV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
        <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_gather_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
                               <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                               <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGatherV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGatherV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_gather_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_gather_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayGatherV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGatherV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_grad</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    source: A `string`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type mutable `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_grad op does not support eager execution. Arg &#39;grad_handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGrad&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGrad&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGrad</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGrad&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_grad</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_grad op does not support eager execution. Arg &#39;grad_handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_grad_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayGradV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    source: A `string`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayGradV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_grad_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGradV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGradV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_grad_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayGradV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_TensorArrayGradV3Output</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;grad_handle&quot;</span><span class="p">,</span> <span class="s2">&quot;flow_out&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Creates a TensorArray for storing the gradients of values in the given handle.</span>

<span class="sd">  If the given TensorArray gradient already exists, returns a reference to it.</span>

<span class="sd">  Locks the size of the original TensorArray by disabling its dynamic size flag.</span>

<span class="sd">  **A note about the input flow_in:**</span>

<span class="sd">  The handle flow_in forces the execution of the gradient lookup to occur</span>
<span class="sd">  only after certain other operations have occurred.  For example, when</span>
<span class="sd">  the forward TensorArray is dynamically sized, writes to this TensorArray</span>
<span class="sd">  may resize the object.  The gradient TensorArray is statically sized based</span>
<span class="sd">  on the size of the forward TensorArray when this operation executes.</span>
<span class="sd">  Furthermore, the size of the forward TensorArray is frozen by this call.</span>
<span class="sd">  As a result, the flow is used to ensure that the call to generate the gradient</span>
<span class="sd">  TensorArray only happens after all writes are executed.</span>

<span class="sd">  In the case of dynamically sized TensorArrays, gradient computation should</span>
<span class="sd">  only be performed on read operations that have themselves been chained via</span>
<span class="sd">  flow to occur only after all writes have executed. That way the final size</span>
<span class="sd">  of the forward TensorArray is known when this operation is called.</span>

<span class="sd">  **A note about the source attribute:**</span>

<span class="sd">  TensorArray gradient calls use an accumulator TensorArray object.  If</span>
<span class="sd">  multiple gradients are calculated and run in the same session, the multiple</span>
<span class="sd">  gradient nodes may accidentally flow through the same accumulator TensorArray.</span>
<span class="sd">  This double counts and generally breaks the TensorArray gradient flow.</span>

<span class="sd">  The solution is to identify which gradient call this particular</span>
<span class="sd">  TensorArray gradient is being called in.  This is performed by identifying</span>
<span class="sd">  a unique string (e.g. &quot;gradients&quot;, &quot;gradients_1&quot;, ...) from the input</span>
<span class="sd">  gradient Tensor&#39;s name.  This string is used as a suffix when creating</span>
<span class="sd">  the TensorArray gradient object here (the attribute `source`).</span>

<span class="sd">  The attribute `source` is added as a suffix to the forward TensorArray&#39;s</span>
<span class="sd">  name when performing the creation / lookup, so that each separate gradient</span>
<span class="sd">  calculation gets its own TensorArray accumulator.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`.</span>
<span class="sd">      The handle to the forward TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    source: A `string`.</span>
<span class="sd">      The gradient source string, used to decide which gradient TensorArray</span>
<span class="sd">      to return.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (grad_handle, flow_out).</span>

<span class="sd">    grad_handle: A `Tensor` of type `resource`.</span>
<span class="sd">    flow_out: A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_grad_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGradV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGradV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_grad_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_TensorArrayGradWithShapeOutput</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;grad_handle&quot;</span><span class="p">,</span> <span class="s2">&quot;flow_out&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_with_shape</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">shape_to_prepend</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Creates a TensorArray for storing multiple gradients of values in the given handle.</span>

<span class="sd">  Similar to TensorArrayGradV3. However it creates an accumulator with an</span>
<span class="sd">  expanded shape compared to the input TensorArray whose gradient is being</span>
<span class="sd">  computed. This enables multiple gradients for the same TensorArray to be</span>
<span class="sd">  calculated using the same accumulator.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`.</span>
<span class="sd">      The handle to the forward TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    shape_to_prepend: A `Tensor` of type `int32`.</span>
<span class="sd">      An int32 vector representing a shape. Elements in the gradient accumulator will</span>
<span class="sd">      have shape which is this shape_to_prepend value concatenated with shape of the</span>
<span class="sd">      elements in the TensorArray corresponding to the input handle.</span>
<span class="sd">    source: A `string`.</span>
<span class="sd">      The gradient source string, used to decide which gradient TensorArray</span>
<span class="sd">      to return.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (grad_handle, flow_out).</span>

<span class="sd">    grad_handle: A `Tensor` of type `resource`.</span>
<span class="sd">    flow_out: A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">shape_to_prepend</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradWithShapeOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_grad_with_shape_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">shape_to_prepend</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                                    <span class="n">shape_to_prepend</span><span class="o">=</span><span class="n">shape_to_prepend</span><span class="p">,</span>
                                    <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradWithShapeOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayGradWithShape</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayGradWithShape&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_grad_with_shape</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_grad_with_shape_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">shape_to_prepend</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">source</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">shape_to_prepend</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">shape_to_prepend</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">shape_to_prepend</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                             <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayGradWithShape&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayGradWithShapeOutput</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_pack</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_pack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayPack&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                           <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayPack&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayPack</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayPack&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_pack</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_pack_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_pack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_read</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_read op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayRead&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                           <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayRead&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayRead</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayRead&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_read</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_read_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_read op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_read_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayReadV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayReadV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_read_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayReadV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayReadV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_read_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_read_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayReadV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_read_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Read an element from the TensorArray into output `value`.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    dtype: A `tf.DType`. The type of the elem that is returned.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `dtype`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayReadV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_read_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayReadV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayReadV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_read_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_read_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayReadV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayReadV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_scatter</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_scatter op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatter&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                              <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatter&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayScatter</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayScatter&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_scatter</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_scatter_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_scatter op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_scatter_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayScatterV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayScatterV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_scatter_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayScatterV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayScatterV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_scatter_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_scatter_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayScatterV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_scatter_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Scatter the data from the input value into specific TensorArray elements.</span>

<span class="sd">  `indices` must be a vector, its length must match the first dim of `value`.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    indices: A `Tensor` of type `int32`.</span>
<span class="sd">      The locations at which to write the tensor elements.</span>
<span class="sd">    value: A `Tensor`. The concatenated tensor to write to the TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayScatterV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_scatter_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayScatterV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayScatterV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_scatter_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_scatter_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayScatterV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayScatterV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_size</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySize&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySize&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySize</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySize&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_size</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_size_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_size op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_size_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArraySizeV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArraySizeV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_size_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySizeV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySizeV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_size_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_size_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArraySizeV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_size_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the current size of the TensorArray.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`.</span>
<span class="sd">      The handle to a TensorArray (output of TensorArray or TensorArrayGrad).</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `int32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArraySizeV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_size_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySizeV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySizeV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_size_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_size_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArraySizeV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySizeV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_split</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_split op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplit&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="n">lengths</span><span class="p">,</span>
                            <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplit&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySplit</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySplit&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_split</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_split_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_split op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_split_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArraySplitV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArraySplitV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_split_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="n">lengths</span><span class="p">,</span>
                              <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySplitV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySplitV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_split_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_split_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">lengths</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArraySplitV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_split_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Split the data from the input value into TensorArray elements.</span>

<span class="sd">  Assuming that `lengths` takes on values</span>

<span class="sd">    ```(n0, n1, ..., n(T-1))```</span>

<span class="sd">  and that `value` has shape</span>

<span class="sd">    ```(n0 + n1 + ... + n(T-1) x d0 x d1 x ...)```,</span>

<span class="sd">  this splits values into a TensorArray with T tensors.</span>

<span class="sd">  TensorArray index t will be the subtensor of values with starting position</span>

<span class="sd">    ```(n0 + n1 + ... + n(t-1), 0, 0, ...)```</span>

<span class="sd">  and having size</span>

<span class="sd">    ```nt x d0 x d1 x ...```</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    value: A `Tensor`. The concatenated tensor to write to the TensorArray.</span>
<span class="sd">    lengths: A `Tensor` of type `int64`.</span>
<span class="sd">      The vector of lengths, how to split the rows of value into the</span>
<span class="sd">      TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArraySplitV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_split_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="n">lengths</span><span class="p">,</span>
                              <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArraySplitV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArraySplitV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_split_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_split_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">lengths</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArraySplitV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArraySplitV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_unpack</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_unpack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayUnpack&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayUnpack&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayUnpack</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayUnpack&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_unpack</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_unpack_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_unpack op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_v2</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayV3</span>

<span class="sd">  Args:</span>
<span class="sd">    size: A `Tensor` of type `int32`.</span>
<span class="sd">    dtype: A `tf.DType`.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">    dynamic_size: An optional `bool`. Defaults to `False`.</span>
<span class="sd">    clear_after_read: An optional `bool`. Defaults to `True`.</span>
<span class="sd">    tensor_array_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `string`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
        <span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span>
        <span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span>
            <span class="n">dynamic_size</span><span class="o">=</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="o">=</span><span class="n">clear_after_read</span><span class="p">,</span>
            <span class="n">tensor_array_name</span><span class="o">=</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">dynamic_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">dynamic_size</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">dynamic_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">clear_after_read</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clear_after_read</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">clear_after_read</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tensor_array_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV2&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span>
                         <span class="n">dynamic_size</span><span class="o">=</span><span class="n">dynamic_size</span><span class="p">,</span>
                         <span class="n">clear_after_read</span><span class="o">=</span><span class="n">clear_after_read</span><span class="p">,</span>
                         <span class="n">tensor_array_name</span><span class="o">=</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">),</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;dynamic_size&quot;</span><span class="p">),</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;clear_after_read&quot;</span><span class="p">),</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;tensor_array_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_v2_eager_fallback</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">dynamic_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">dynamic_size</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">dynamic_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">clear_after_read</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clear_after_read</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">clear_after_read</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tensor_array_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">)</span>
  <span class="n">size</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span>
  <span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span>
  <span class="n">tensor_array_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">_TensorArrayV3Output</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">,</span> <span class="s2">&quot;flow&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">tensor_array_v3</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">identical_element_shapes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An array of Tensors of given size.</span>

<span class="sd">  Write data via Write and read via Read or Pack.</span>

<span class="sd">  Args:</span>
<span class="sd">    size: A `Tensor` of type `int32`. The size of the array.</span>
<span class="sd">    dtype: A `tf.DType`. The type of the elements on the tensor_array.</span>
<span class="sd">    element_shape: An optional `tf.TensorShape` or list of `ints`. Defaults to `None`.</span>
<span class="sd">      The expected shape of an element, if known. Used to</span>
<span class="sd">      validate the shapes of TensorArray elements. If this shape is not</span>
<span class="sd">      fully specified, gathering zero-size TensorArrays is an error.</span>
<span class="sd">    dynamic_size: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      A boolean that determines whether writes to the TensorArray</span>
<span class="sd">      are allowed to grow the size.  By default, this is not allowed.</span>
<span class="sd">    clear_after_read: An optional `bool`. Defaults to `True`.</span>
<span class="sd">      If true (default), Tensors in the TensorArray are cleared</span>
<span class="sd">      after being read.  This disables multiple read semantics but allows early</span>
<span class="sd">      release of memory.</span>
<span class="sd">    identical_element_shapes: An optional `bool`. Defaults to `False`.</span>
<span class="sd">      If true (default is false), then all</span>
<span class="sd">      elements in the TensorArray will be expected to have have identical shapes.</span>
<span class="sd">      This allows certain behaviors, like dynamically checking for</span>
<span class="sd">      consistent shapes on write, and being able to fill in properly</span>
<span class="sd">      shaped zero tensors on stack -- even if the element_shape attribute</span>
<span class="sd">      is not fully defined.</span>
<span class="sd">    tensor_array_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">      Overrides the name used for the temporary tensor_array</span>
<span class="sd">      resource. Default value is the name of the &#39;TensorArray&#39; op (which</span>
<span class="sd">      is guaranteed unique).</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A tuple of `Tensor` objects (handle, flow).</span>

<span class="sd">    handle: A `Tensor` of type `resource`.</span>
<span class="sd">    flow: A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
        <span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span>
        <span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">,</span>
        <span class="n">identical_element_shapes</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="p">)</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span>
            <span class="n">dynamic_size</span><span class="o">=</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="o">=</span><span class="n">clear_after_read</span><span class="p">,</span>
            <span class="n">identical_element_shapes</span><span class="o">=</span><span class="n">identical_element_shapes</span><span class="p">,</span>
            <span class="n">tensor_array_name</span><span class="o">=</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">dynamic_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">dynamic_size</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">dynamic_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">clear_after_read</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clear_after_read</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">clear_after_read</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">identical_element_shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">identical_element_shapes</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">identical_element_shapes</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">identical_element_shapes</span><span class="p">,</span> <span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tensor_array_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="o">=</span><span class="n">element_shape</span><span class="p">,</span>
                         <span class="n">dynamic_size</span><span class="o">=</span><span class="n">dynamic_size</span><span class="p">,</span>
                         <span class="n">clear_after_read</span><span class="o">=</span><span class="n">clear_after_read</span><span class="p">,</span>
                         <span class="n">identical_element_shapes</span><span class="o">=</span><span class="n">identical_element_shapes</span><span class="p">,</span>
                         <span class="n">tensor_array_name</span><span class="o">=</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">),</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;element_shape&quot;</span><span class="p">),</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;dynamic_size&quot;</span><span class="p">),</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;clear_after_read&quot;</span><span class="p">),</span>
              <span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_bool</span><span class="p">(</span><span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">),</span>
              <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;tensor_array_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_v3_eager_fallback</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="n">dynamic_size</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="p">,</span> <span class="n">identical_element_shapes</span><span class="p">,</span> <span class="n">tensor_array_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">element_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">element_shape</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">element_shape</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_shape</span><span class="p">(</span><span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">dynamic_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">dynamic_size</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">dynamic_size</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">clear_after_read</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">clear_after_read</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="n">clear_after_read</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">clear_after_read</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">identical_element_shapes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">identical_element_shapes</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">identical_element_shapes</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_bool</span><span class="p">(</span><span class="n">identical_element_shapes</span><span class="p">,</span> <span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">tensor_array_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">tensor_array_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">tensor_array_name</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">)</span>
  <span class="n">size</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;element_shape&quot;</span><span class="p">,</span> <span class="n">element_shape</span><span class="p">,</span> <span class="s2">&quot;dynamic_size&quot;</span><span class="p">,</span>
  <span class="n">dynamic_size</span><span class="p">,</span> <span class="s2">&quot;clear_after_read&quot;</span><span class="p">,</span> <span class="n">clear_after_read</span><span class="p">,</span>
  <span class="s2">&quot;identical_element_shapes&quot;</span><span class="p">,</span> <span class="n">identical_element_shapes</span><span class="p">,</span> <span class="s2">&quot;tensor_array_name&quot;</span><span class="p">,</span>
  <span class="n">tensor_array_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_TensorArrayV3Output</span><span class="o">.</span><span class="n">_make</span><span class="p">(</span><span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_write</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;TODO: add doc.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type mutable `string`.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_write op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWrite&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWrite&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayWrite</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayWrite&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_write</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_write_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;tensor_array_write op does not support eager execution. Arg &#39;handle&#39; is a ref.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tensor_array_write_v2</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deprecated. Use TensorArrayGradV3</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `string`.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">    value: A `Tensor`.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayWriteV2&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_write_v2_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV2&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                              <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayWriteV2</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayWriteV2&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_write_v2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_write_v2_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayWriteV2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV2&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">tensor_array_write_v3</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Push an element onto the tensor_array.</span>

<span class="sd">  Args:</span>
<span class="sd">    handle: A `Tensor` of type `resource`. The handle to a TensorArray.</span>
<span class="sd">    index: A `Tensor` of type `int32`.</span>
<span class="sd">      The position to write to inside the TensorArray.</span>
<span class="sd">    value: A `Tensor`. The tensor to write to the TensorArray.</span>
<span class="sd">    flow_in: A `Tensor` of type `float32`.</span>
<span class="sd">      A float scalar that enforces proper chaining of operations.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A `Tensor` of type `float32`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;TensorArrayWriteV3&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tensor_array_write_v3_eager_fallback</span><span class="p">(</span>
            <span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV3&quot;</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                              <span class="n">flow_in</span><span class="o">=</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_type</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">TensorArrayWriteV3</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.TensorArrayWriteV3&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">tensor_array_write_v3</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">tensor_array_write_v3_eager_fallback</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="n">_attr_T</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">args_to_matching_eager</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">handle</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
  <span class="n">index</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">flow_in</span> <span class="o">=</span> <span class="n">_ops</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">flow_in</span><span class="p">,</span> <span class="n">_dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">handle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">flow_in</span><span class="p">]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">_attr_T</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;TensorArrayWriteV3&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;TensorArrayWriteV3&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="n">_result</span><span class="p">,</span> <span class="o">=</span> <span class="n">_result</span>
  <span class="k">return</span> <span class="n">_result</span>


<span class="k">def</span> <span class="nf">unstage</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Op is similar to a lightweight Dequeue.</span>

<span class="sd">  The basic functionality is similar to dequeue with many fewer</span>
<span class="sd">  capabilities and options.  This Op is optimized for performance.</span>

<span class="sd">  Args:</span>
<span class="sd">    dtypes: A list of `tf.DTypes` that has length `&gt;= 1`.</span>
<span class="sd">    capacity: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    memory_limit: An optional `int` that is `&gt;= 0`. Defaults to `0`.</span>
<span class="sd">    container: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    shared_name: An optional `string`. Defaults to `&quot;&quot;`.</span>
<span class="sd">    name: A name for the operation (optional).</span>

<span class="sd">  Returns:</span>
<span class="sd">    A list of `Tensor` objects of type `dtypes`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">_ctx</span> <span class="o">=</span> <span class="n">_context</span><span class="o">.</span><span class="n">_context</span> <span class="ow">or</span> <span class="n">_context</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
  <span class="n">tld</span> <span class="o">=</span> <span class="n">_ctx</span><span class="o">.</span><span class="n">_thread_local_data</span>
  <span class="k">if</span> <span class="n">tld</span><span class="o">.</span><span class="n">is_eager</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">_result</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_FastPathExecute</span><span class="p">(</span>
        <span class="n">_ctx</span><span class="o">.</span><span class="n">_context_handle</span><span class="p">,</span> <span class="n">tld</span><span class="o">.</span><span class="n">device_name</span><span class="p">,</span> <span class="s2">&quot;Unstage&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">tld</span><span class="o">.</span><span class="n">op_callbacks</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span>
        <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">_result</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_FallbackException</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">unstage_eager_fallback</span><span class="p">(</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">_ctx</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_SymbolicException</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Add nodes to the TensorFlow graph.</span>
    <span class="k">except</span> <span class="n">_core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">_ops</span><span class="o">.</span><span class="n">raise_from_not_ok_status</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="c1"># Add nodes to the TensorFlow graph.</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_op</span><span class="p">,</span> <span class="n">_outputs</span> <span class="o">=</span> <span class="n">_op_def_library</span><span class="o">.</span><span class="n">_apply_op_helper</span><span class="p">(</span>
        <span class="s2">&quot;Unstage&quot;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
                   <span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                   <span class="n">shared_name</span><span class="o">=</span><span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_outputs</span><span class="p">[:]</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">_result</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_op</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">),</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">_get_attr_int</span><span class="p">(</span><span class="s2">&quot;memory_limit&quot;</span><span class="p">),</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
              <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;dtypes&quot;</span><span class="p">),</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;container&quot;</span><span class="p">),</span>
              <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">_op</span><span class="o">.</span><span class="n">get_attr</span><span class="p">(</span><span class="s2">&quot;shared_name&quot;</span><span class="p">))</span>
    <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="n">_op</span><span class="o">.</span><span class="n">inputs</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;Unstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

<span class="n">Unstage</span> <span class="o">=</span> <span class="n">tf_export</span><span class="p">(</span><span class="s2">&quot;raw_ops.Unstage&quot;</span><span class="p">)(</span><span class="n">_ops</span><span class="o">.</span><span class="n">to_raw_op</span><span class="p">(</span><span class="n">unstage</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">unstage_eager_fallback</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
        <span class="s2">&quot;Expected list for &#39;dtypes&#39; argument to &quot;</span>
        <span class="s2">&quot;&#39;unstage&#39; Op, not </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">dtypes</span><span class="p">)</span>
  <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_execute</span><span class="o">.</span><span class="n">make_type</span><span class="p">(</span><span class="n">_t</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_t</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">capacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">capacity</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_int</span><span class="p">(</span><span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">container</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">shared_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">shared_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">shared_name</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">make_str</span><span class="p">(</span><span class="n">shared_name</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">)</span>
  <span class="n">_inputs_flat</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span> <span class="n">memory_limit</span><span class="p">,</span> <span class="s2">&quot;dtypes&quot;</span><span class="p">,</span>
  <span class="n">dtypes</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="s2">&quot;shared_name&quot;</span><span class="p">,</span> <span class="n">shared_name</span><span class="p">)</span>
  <span class="n">_result</span> <span class="o">=</span> <span class="n">_execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Unstage&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">),</span> <span class="n">inputs</span><span class="o">=</span><span class="n">_inputs_flat</span><span class="p">,</span>
                             <span class="n">attrs</span><span class="o">=</span><span class="n">_attrs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_execute</span><span class="o">.</span><span class="n">must_record_gradient</span><span class="p">():</span>
    <span class="n">_execute</span><span class="o">.</span><span class="n">record_gradient</span><span class="p">(</span>
        <span class="s2">&quot;Unstage&quot;</span><span class="p">,</span> <span class="n">_inputs_flat</span><span class="p">,</span> <span class="n">_attrs</span><span class="p">,</span> <span class="n">_result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_result</span>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright - Wei MEI (Nick Cafferry).

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>